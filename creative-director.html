<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Creative Director | Neural Ad Forge | Barrios A2I</title>
    <meta name="description" content="Your AI Creative Director is ready. Build a production-ready commercial brief in minutes with guided questions.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#0a0a0f',
                        obsidian: '#0a0a1e',
                        neon: '#00F3FF',
                        primary: '#00CED1',
                        accent: '#F59E0B',
                        glass: 'rgba(255, 255, 255, 0.05)',
                        glassHover: 'rgba(255, 255, 255, 0.1)',
                        'brand-teal': '#00CED1',
                        'brand-gold': '#ffd700',
                    },
                    fontFamily: {
                        sans: ['Syne', 'sans-serif'],
                        serif: ['Instrument Serif', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: #0a0a0f; color: white; margin: 0; overflow-x: hidden; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 0; pointer-events: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #00F3FF; }
        .neon-text-shadow { text-shadow: 0 0 10px rgba(0, 243, 255, 0.5), 0 0 20px rgba(0, 243, 255, 0.3); }
        @keyframes fadeSlideIn { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        .chat-container::-webkit-scrollbar { width: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: rgba(0, 243, 255, 0.3); border-radius: 2px; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 5px rgba(0, 243, 255, 0.3); } 50% { box-shadow: 0 0 20px rgba(0, 243, 255, 0.6); } }
        .typing-indicator span { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Fix for responsive classes - ensure proper visibility */
        @media (min-width: 640px) {
            .hidden.sm\:block { display: block !important; }
        }
        @media (min-width: 768px) {
            .hidden.md\:flex { display: flex !important; }
            .md\:flex { display: flex !important; }
            .md\:gap-4 { gap: 1rem !important; }
            .md\:gap-5 { gap: 1.25rem !important; }
            .md\:gap-6 { gap: 1.5rem !important; }
            .md\:w-10 { width: 2.5rem !important; }
            .md\:h-10 { height: 2.5rem !important; }
            .md\:w-8 { width: 2rem !important; }
            .md\:h-8 { height: 2rem !important; }
            .md\:w-16 { width: 4rem !important; }
            .md\:h-16 { height: 4rem !important; }
            .md\:w-20 { width: 5rem !important; }
            .md\:h-20 { height: 5rem !important; }
            .md\:w-3 { width: 0.75rem !important; }
            .md\:h-3 { height: 0.75rem !important; }
            .md\:px-6 { padding-left: 1.5rem !important; padding-right: 1.5rem !important; }
            .md\:py-6 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .md\:-top-1 { top: -0.25rem !important; }
            .md\:-right-1 { right: -0.25rem !important; }
            .md\:-top-2 { top: -0.5rem !important; }
            .md\:-right-2 { right: -0.5rem !important; }
            .md\:w-2 { width: 0.5rem !important; }
            .md\:h-2 { height: 0.5rem !important; }
        }
        @media (min-width: 1024px) {
            .hidden.lg\:flex { display: flex !important; }
            .lg\:flex { display: flex !important; }
            .lg\:hidden { display: none !important; }
        }

        /* Nav Link Styles (from landing page) */
        .nav-link { position: relative; }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 1px;
            background: #ffd700;
            box-shadow: 0 0 8px #ffd700;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after { width: 75%; }
        .nav-link:hover .bracket { color: #ffd700; }
        .nav-link.active::after { width: 75%; }
        .nav-link.active .bracket { color: #ffd700; }

        /* Scanline Effect */
        .scanline-overlay {
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.15) 50%),
                        linear-gradient(90deg, rgba(255,0,0,0.02), rgba(0,255,0,0.01), rgba(0,0,255,0.02));
            background-size: 100% 2px, 3px 100%;
        }

        /* Volumetric Glow */
        .volumetric-glow {
            filter: drop-shadow(0 0 8px rgba(0, 206, 209, 0.5));
        }
        .volumetric-glow:hover {
            filter: drop-shadow(0 0 15px rgba(0, 206, 209, 0.7));
        }

        /* Pipeline Phase Indicator */
        .pipeline-phases {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .phase-dot {
            font-size: 9px;
            padding: 3px 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            color: rgba(255,255,255,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        .phase-dot.active {
            background: rgba(0, 243, 255, 0.15);
            color: #00F3FF;
            border-color: rgba(0, 243, 255, 0.3);
        }
        .phase-dot.completed {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }

        /* Concept Cards */
        .concept-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 12px 0;
        }
        .concept-card {
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .concept-card:hover {
            border-color: #00F3FF;
            background: rgba(0, 243, 255, 0.1);
            transform: translateX(4px);
        }
        .concept-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        .concept-title {
            font-size: 13px;
            font-weight: 600;
            color: white;
            margin-bottom: 6px;
        }
        .concept-hook {
            font-size: 11px;
            color: rgba(255,255,255,0.6);
            margin-bottom: 6px;
            line-height: 1.4;
        }
        .concept-score {
            font-size: 10px;
            color: #00F3FF;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Script Preview */
        .script-preview {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
        }
        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
            color: white;
        }
        .script-duration {
            font-family: 'JetBrains Mono', monospace;
            color: #00F3FF;
        }
        .script-scenes {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        .script-scenes::-webkit-scrollbar { height: 4px; }
        .script-scenes::-webkit-scrollbar-thumb { background: rgba(0, 243, 255, 0.3); border-radius: 2px; }
        .scene-card {
            min-width: 120px;
            max-width: 140px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px;
            font-size: 10px;
            flex-shrink: 0;
        }
        .scene-type {
            font-weight: 600;
            color: #00F3FF;
            margin-bottom: 4px;
            text-transform: uppercase;
            font-size: 9px;
            letter-spacing: 0.05em;
        }
        .scene-content {
            color: rgba(255,255,255,0.7);
            line-height: 1.3;
        }
        .script-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .btn-approve {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-approve:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        .btn-revise {
            padding: 8px 12px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: rgba(255,255,255,0.6);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-revise:hover {
            border-color: rgba(255,255,255,0.4);
            color: white;
        }

        /* Quality Score */
        .quality-score {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 8px;
            margin-top: 8px;
        }
        .quality-score.low {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.2);
        }
        .quality-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            color: #10b981;
        }
        .quality-score.low .quality-value {
            color: #ef4444;
        }
        .quality-label {
            font-size: 10px;
            color: rgba(255,255,255,0.6);
        }

        /* System Messages */
        .system-message {
            display: flex;
            justify-content: center;
            padding: 8px 0;
        }
        .system-message span {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.05);
            padding: 4px 12px;
            border-radius: 12px;
        }

        /* Pipeline Badge */
        .pipeline-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.2), rgba(16, 185, 129, 0.2));
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 4px;
            font-size: 9px;
            color: #00F3FF;
            font-weight: 600;
            letter-spacing: 0.1em;
        }

        .hidden { display: none !important; }

        /* Neural Processing Visualization - Legendary Neural Engine */
        .nexus-neural-processing {
            padding: 12px;
            background: rgba(0, 206, 209, 0.05);
            border: 1px solid rgba(0, 206, 209, 0.2);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .nexus-neural-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .nexus-neural-mode {
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(0, 206, 209, 0.2);
            color: #00CED1;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .nexus-neural-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .nexus-neural-tokens {
            display: flex;
            gap: 4px;
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            font-size: 11px;
        }

        .nexus-token {
            padding: 2px 4px;
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
        }

        .nexus-token--active {
            color: #00CED1;
            text-shadow: 0 0 8px rgba(0, 206, 209, 0.5);
        }

        .nexus-neural-progress {
            margin-top: 8px;
        }

        .nexus-progress-bar {
            height: 2px;
            background: linear-gradient(90deg, #00CED1, #00F3FF);
            border-radius: 1px;
            animation: progress-pulse 1.5s ease-in-out infinite;
        }

        @keyframes progress-pulse {
            0%, 100% { width: 20%; opacity: 0.5; }
            50% { width: 80%; opacity: 1; }
        }

        /* Metrics badge */
        .nexus-message-metrics {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 10px;
            color: rgba(255, 255, 255, 0.4);
        }

        .nexus-metric {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .nexus-metric-icon {
            font-size: 9px;
        }

        .nexus-metric--mode {
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            background: rgba(0, 206, 209, 0.1);
            padding: 1px 5px;
            border-radius: 3px;
            color: #00CED1;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        /* ============================================
           UI/UX ENHANCEMENTS - Tesla Minimalism + Cyberpunk
           ============================================ */

        /* 1. NEXUS Chat Widget - Active Glow Pulse */
        .nexus-panel--open {
            animation: nexus-glow-pulse 2.5s ease-in-out infinite;
        }

        @keyframes nexus-glow-pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(0, 206, 209, 0.15),
                            0 0 40px rgba(0, 206, 209, 0.08),
                            inset 0 0 20px rgba(0, 206, 209, 0.02);
            }
            50% {
                box-shadow: 0 0 35px rgba(0, 206, 209, 0.25),
                            0 0 70px rgba(0, 206, 209, 0.12),
                            inset 0 0 30px rgba(0, 206, 209, 0.04);
            }
        }

        /* Floating animation for minimized launcher */
        .nexus-launcher {
            animation: nexus-float 3s ease-in-out infinite;
        }

        @keyframes nexus-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        /* 2. Neural Token Particle Burst */
        .nexus-token {
            position: relative;
            padding: 3px 6px;
            color: rgba(255, 255, 255, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            border-radius: 4px;
        }

        .nexus-token--active {
            color: #00CED1;
            background: rgba(0, 206, 209, 0.15);
            text-shadow: 0 0 12px rgba(0, 206, 209, 0.8),
                         0 0 24px rgba(0, 206, 209, 0.4);
            animation: token-burst 0.5s ease-out;
        }

        @keyframes token-burst {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 206, 209, 0.6);
            }
            50% {
                transform: scale(1.2);
                box-shadow: 0 0 0 10px rgba(0, 206, 209, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 206, 209, 0);
            }
        }

        /* 3. Hero Mesh Background */
        .hero-mesh-bg {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(0, 206, 209, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 206, 209, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: mesh-drift 25s linear infinite;
            mask-image: radial-gradient(ellipse 90% 70% at 50% 40%, black 20%, transparent 70%);
            -webkit-mask-image: radial-gradient(ellipse 90% 70% at 50% 40%, black 20%, transparent 70%);
            pointer-events: none;
        }

        @keyframes mesh-drift {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        /* Floating orbs */
        .hero-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            animation: orb-float 10s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        .hero-orb--cyan {
            width: 500px;
            height: 500px;
            background: rgba(0, 206, 209, 0.06);
            top: 5%;
            right: 5%;
        }

        .hero-orb--purple {
            width: 400px;
            height: 400px;
            background: rgba(139, 92, 246, 0.05);
            bottom: 10%;
            left: 0;
            animation-delay: -5s;
        }

        @keyframes orb-float {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
            33% { transform: translate(25px, -15px) scale(1.05); opacity: 0.8; }
            66% { transform: translate(-15px, 10px) scale(0.95); opacity: 0.5; }
        }

        /* 4. CTA Button Breathing Glow */
        .cta-glow {
            position: relative;
            animation: cta-breathe 3s ease-in-out infinite;
        }

        .cta-glow::before {
            content: '';
            position: absolute;
            inset: -3px;
            background: linear-gradient(45deg, #00CED1, #8B5CF6, #00F3FF, #00CED1);
            background-size: 300% 300%;
            animation: gradient-shift 4s ease infinite;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
            filter: blur(12px);
            border-radius: inherit;
        }

        .cta-glow:hover::before {
            opacity: 0.5;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes cta-breathe {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(0, 206, 209, 0),
                            inset 0 0 15px rgba(0, 206, 209, 0.03);
            }
            50% {
                box-shadow: 0 0 25px rgba(0, 206, 209, 0.12),
                            inset 0 0 25px rgba(0, 206, 209, 0.06);
            }
        }

        /* 5. Metrics Badge Micro-Interactions */
        .nexus-message-metrics {
            animation: metrics-slide-in 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes metrics-slide-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nexus-metric {
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.03);
            transition: all 0.25s ease;
            cursor: default;
        }

        .nexus-metric:hover {
            background: rgba(0, 206, 209, 0.12);
            transform: translateY(-2px);
        }

        .nexus-metric--mode {
            position: relative;
            overflow: hidden;
        }

        .nexus-metric--mode::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 206, 209, 0.25), transparent);
            animation: metric-shimmer 2.5s ease-in-out infinite;
        }

        @keyframes metric-shimmer {
            100% { left: 100%; }
        }

        .nexus-mode-icon {
            font-size: 10px;
            margin-right: 3px;
        }

        /* 6. Enhanced Progress Bar */
        .nexus-progress-bar {
            height: 3px;
            background: linear-gradient(90deg,
                transparent 0%,
                #00CED1 15%,
                #00F3FF 50%,
                #00CED1 85%,
                transparent 100%
            );
            background-size: 200% 100%;
            border-radius: 2px;
            animation: progress-wave 1s ease-in-out infinite;
            position: relative;
            overflow: visible;
        }

        @keyframes progress-wave {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }

        .nexus-progress-bar::before,
        .nexus-progress-bar::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #00F3FF;
            top: -1.5px;
            box-shadow: 0 0 8px #00F3FF;
            animation: particle-move 1s ease-in-out infinite;
        }

        .nexus-progress-bar::after {
            animation-delay: 0.5s;
        }

        @keyframes particle-move {
            0% { left: 0%; opacity: 0; transform: scale(0.5); }
            15% { opacity: 1; transform: scale(1); }
            85% { opacity: 1; transform: scale(1); }
            100% { left: 100%; opacity: 0; transform: scale(0.5); }
        }

        /* 7. Border Radius System */
        :root {
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        /* 8. Chat Widget Container Glow */
        #chat > div {
            transition: all 0.4s ease;
        }

        #chat > div:hover {
            box-shadow: 0 0 40px rgba(0, 206, 209, 0.1),
                        0 0 80px rgba(0, 206, 209, 0.05);
        }

        /* 9. Scanline overlay enhancement */
        .scanline-active::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 206, 209, 0.01) 2px,
                rgba(0, 206, 209, 0.01) 4px
            );
            pointer-events: none;
            animation: scanline-scroll 8s linear infinite;
        }

        @keyframes scanline-scroll {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }

        /* 10. Entrance animations for hero elements */
        .hero-animate-1 { animation: hero-fade-up 0.8s ease-out 0.2s both; }
        .hero-animate-2 { animation: hero-fade-up 0.8s ease-out 0.4s both; }
        .hero-animate-3 { animation: hero-fade-up 0.8s ease-out 0.6s both; }
        .hero-animate-4 { animation: hero-fade-up 0.8s ease-out 0.8s both; }

        @keyframes hero-fade-up {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <!-- Payment handled via Stripe Payment Link -->

    <!-- NEXUS BRIDGE SSE Client for real-time production tracking -->
    <script src="js/nexus_sse_client.js"></script>
    <!-- Agent Micro-Visualizations (React via esm.sh) -->
    <script type="module" src="js/agent-visuals-integration.js"></script>
    <!-- Neural RAG Brain v3.0 Cognitive Status Panel -->
    <script src="js/neural-brain-integration.js"></script>
</head>
<body class="antialiased font-sans selection:bg-neon selection:text-white">
    <div id="canvas-container"></div>

    <!-- ========== GLOBAL HEADER (REMASTERED) ========== -->
    <header id="global-header" class="fixed top-0 left-0 right-0 z-[100] px-4 md:px-6 py-3 md:py-6 transition-all duration-300">
        <!-- Glassmorphism Background -->
        <div class="absolute inset-0 bg-transparent backdrop-blur-none transition-all duration-300" id="header-bg"></div>

        <nav class="max-w-7xl mx-auto relative flex items-center justify-between">
            <!-- Brand Section with Status Indicator -->
            <a href="/" class="flex items-center gap-4 md:gap-5 group">
                <div class="relative">
                    <!-- Shard Logo with Volumetric Glow (2x size) -->
                    <div class="relative w-14 h-14 md:w-20 md:h-20 flex items-center justify-center">
                        <div class="absolute inset-0 bg-brand-teal blur-xl opacity-20 group-hover:opacity-40 transition-opacity duration-300 rounded-full"></div>
                        <img
                            src="brand/barrios-a2i-shard-logo.png"
                            alt="Barrios A2I"
                            class="relative w-12 h-12 md:w-16 md:h-16 object-contain volumetric-glow transition-all duration-300"
                        >
                    </div>
                    <!-- Active Status Dot -->
                    <div class="absolute -top-1 -right-1 md:-top-2 md:-right-2 w-2.5 h-2.5 md:w-3 md:h-3 bg-brand-gold rounded-full animate-pulse"></div>
                </div>
                <div class="hidden md:flex flex-col">
                    <span class="text-brand-teal font-mono text-xs tracking-[0.2em] leading-none mb-1">SYSTEM_CONNECTED</span>
                    <span class="text-white font-black tracking-tighter text-2xl leading-none">
                        BARRIOS <span class="text-brand-gold">A2I</span>
                    </span>
                </div>
            </a>

            <!-- Center Navigation with Gold Trace (Desktop) -->
            <div class="hidden lg:flex items-center gap-2">
                <a href="/#stack" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">STACK</span>
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">]</span>
                </a>
                <a href="/#velocity" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">VELOCITY</span>
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">]</span>
                </a>
                <a href="/#architecture" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">ARCHITECTURE</span>
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">]</span>
                </a>
                <a href="/#pricing" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">PRICING</span>
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">]</span>
                </a>
                <a href="/nexus-personal" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-white transition-colors flex items-center gap-2">
                        NEXUS
                        <span class="w-1.5 h-1.5 bg-brand-teal rounded-full shadow-[0_0_8px_#00CED1]"></span>
                    </span>
                    <span class="bracket text-brand-teal/40 font-mono text-sm group-hover:text-brand-gold transition-colors">]</span>
                </a>
                <a href="/creative-director" class="nav-link group flex items-center px-3 py-1.5 transition-all">
                    <span class="bracket text-brand-gold font-mono text-sm">[</span>
                    <span class="mx-2 text-[11px] font-mono tracking-widest text-white transition-colors">AD_FORGE</span>
                    <span class="bracket text-brand-gold font-mono text-sm">]</span>
                </a>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center gap-3 md:gap-6">
                <a href="/login" class="hidden sm:block text-[10px] font-mono text-gray-500 hover:text-brand-gold transition-colors tracking-widest">
                    AUTH_LOGIN
                </a>

                <!-- Desktop CTA -->
                <a href="#chat" onclick="focusChatInput()" class="hidden md:flex group relative px-5 py-2 bg-white/5 border border-brand-teal/30 backdrop-blur-md overflow-hidden hover:border-brand-gold transition-all duration-300">
                    <div class="absolute inset-0 bg-brand-teal/5 group-hover:bg-brand-gold/10 transition-colors"></div>
                    <div class="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-brand-teal to-transparent"></div>
                    <div class="relative flex items-center gap-3">
                        <iconify-icon icon="lucide:terminal" width="14" class="text-brand-teal group-hover:text-brand-gold transition-colors"></iconify-icon>
                        <span class="text-[11px] font-mono font-bold text-white tracking-[0.15em]">BEGIN_INTAKE</span>
                    </div>
                    <div class="absolute top-0 left-0 w-1 h-1 border-t border-l border-brand-teal/50 group-hover:border-brand-gold transition-colors"></div>
                    <div class="absolute bottom-0 right-0 w-1 h-1 border-b border-r border-brand-teal/50 group-hover:border-brand-gold transition-colors"></div>
                </a>

                <!-- Mobile Menu Toggle -->
                <button id="mobile-menu-toggle" class="lg:hidden relative w-10 h-10 flex items-center justify-center rounded-lg border border-white/10 bg-white/5 backdrop-blur-md transition-all hover:border-brand-teal/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-teal/50" aria-label="Toggle navigation menu" aria-expanded="false">
                    <div class="relative w-5 h-4 flex flex-col justify-between">
                        <span id="menu-line-1" class="block w-full h-0.5 bg-brand-teal transition-all duration-300 origin-center"></span>
                        <span id="menu-line-2" class="block w-full h-0.5 bg-brand-teal transition-all duration-300"></span>
                        <span id="menu-line-3" class="block w-full h-0.5 bg-brand-teal transition-all duration-300 origin-center"></span>
                    </div>
                </button>
            </div>
        </nav>

        <!-- Mobile Navigation Drawer -->
        <div id="mobile-nav-drawer" class="lg:hidden absolute left-0 right-0 top-full overflow-hidden transition-all duration-300 ease-out" style="max-height: 0; opacity: 0;">
            <div class="mx-4 mt-2 rounded-2xl border border-white/10 bg-obsidian/95 backdrop-blur-xl shadow-2xl overflow-hidden">
                <!-- Nav Links -->
                <nav class="p-4 space-y-1">
                    <a href="/#stack" class="mobile-nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5">
                        <iconify-icon icon="lucide:layers" width="16" class="text-brand-teal/60 group-hover:text-brand-teal transition-colors"></iconify-icon>
                        <span class="text-xs font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">STACK</span>
                    </a>
                    <a href="/#velocity" class="mobile-nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5">
                        <iconify-icon icon="lucide:zap" width="16" class="text-brand-teal/60 group-hover:text-brand-teal transition-colors"></iconify-icon>
                        <span class="text-xs font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">VELOCITY</span>
                    </a>
                    <a href="/#architecture" class="mobile-nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5">
                        <iconify-icon icon="lucide:git-branch" width="16" class="text-brand-teal/60 group-hover:text-brand-teal transition-colors"></iconify-icon>
                        <span class="text-xs font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">ARCHITECTURE</span>
                    </a>
                    <a href="/#pricing" class="mobile-nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5">
                        <iconify-icon icon="lucide:rocket" width="16" class="text-brand-teal/60 group-hover:text-brand-teal transition-colors"></iconify-icon>
                        <span class="text-xs font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors">PRICING</span>
                    </a>

                    <!-- Divider -->
                    <div class="my-3 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"></div>

                    <!-- Creative Director - Premium Emphasis (Active) -->
                    <a href="/creative-director" class="mobile-nav-link group relative flex items-center gap-3 px-4 py-4 rounded-xl transition-all bg-brand-gold/10 border border-brand-gold/30">
                        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-brand-gold/10 to-transparent opacity-100"></div>
                        <div class="relative flex items-center gap-3">
                            <div class="relative">
                                <iconify-icon icon="lucide:sparkles" width="18" class="text-brand-gold transition-colors"></iconify-icon>
                                <div class="absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-brand-gold rounded-full animate-pulse"></div>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs font-mono tracking-widest text-white font-bold">AD_FORGE</span>
                                <span class="text-[9px] font-mono text-brand-gold/70 tracking-wider">CURRENT PAGE</span>
                            </div>
                        </div>
                    </a>

                    <a href="/nexus-personal" class="mobile-nav-link group flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/5">
                        <iconify-icon icon="lucide:brain" width="16" class="text-brand-teal/60 group-hover:text-brand-teal transition-colors"></iconify-icon>
                        <span class="text-xs font-mono tracking-widest text-gray-400 group-hover:text-white transition-colors flex items-center gap-2">
                            NEXUS
                            <span class="w-1.5 h-1.5 bg-brand-teal rounded-full shadow-[0_0_6px_#00CED1]"></span>
                        </span>
                    </a>
                </nav>

                <!-- Mobile CTA -->
                <div class="p-4 pt-0">
                    <a href="#chat" onclick="focusChatInput()" class="group flex items-center justify-center gap-2 w-full py-3 rounded-xl bg-brand-teal/10 border border-brand-teal/30 transition-all hover:bg-brand-teal/20 hover:border-brand-teal/50">
                        <iconify-icon icon="lucide:terminal" width="14" class="text-brand-teal"></iconify-icon>
                        <span class="text-[11px] font-mono font-bold text-white tracking-[0.15em]">BEGIN_INTAKE</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Header Scroll Behavior + Mobile Menu Script -->
    <script>
    (function() {
        const header = document.getElementById('global-header');
        const headerBg = document.getElementById('header-bg');
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileNavDrawer = document.getElementById('mobile-nav-drawer');
        const menuLine1 = document.getElementById('menu-line-1');
        const menuLine2 = document.getElementById('menu-line-2');
        const menuLine3 = document.getElementById('menu-line-3');
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

        let isMenuOpen = false;

        // Scroll behavior
        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;
            const isMobile = window.innerWidth < 768;

            if (currentScroll > 10) {
                header.classList.remove('py-3', 'md:py-6');
                header.classList.add(isMobile ? 'py-2' : 'py-3');
                headerBg.classList.remove('bg-transparent', 'backdrop-blur-none');
                headerBg.classList.add('bg-obsidian/90', 'backdrop-blur-xl', 'border-b', 'border-white/10');
            } else {
                header.classList.remove('py-2', 'py-3');
                header.classList.add('py-3', 'md:py-6');
                headerBg.classList.remove('bg-obsidian/90', 'backdrop-blur-xl', 'border-b', 'border-white/10');
                headerBg.classList.add('bg-transparent', 'backdrop-blur-none');
            }
        });

        // Mobile menu toggle
        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            mobileMenuToggle.setAttribute('aria-expanded', isMenuOpen);

            if (isMenuOpen) {
                mobileNavDrawer.style.maxHeight = '500px';
                mobileNavDrawer.style.opacity = '1';
                // Animate hamburger to X
                menuLine1.style.transform = 'rotate(45deg) translateY(6px)';
                menuLine2.style.opacity = '0';
                menuLine3.style.transform = 'rotate(-45deg) translateY(-6px)';
            } else {
                mobileNavDrawer.style.maxHeight = '0';
                mobileNavDrawer.style.opacity = '0';
                // Reset hamburger
                menuLine1.style.transform = 'none';
                menuLine2.style.opacity = '1';
                menuLine3.style.transform = 'none';
            }
        }

        mobileMenuToggle.addEventListener('click', toggleMenu);

        // Close menu on nav link click
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (isMenuOpen) {
                    toggleMenu();
                }
            });
        });

        // Close menu on resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024 && isMenuOpen) {
                toggleMenu();
            }
        });
    })();
    </script>

    <main class="relative z-10 w-full">
        <!-- HERO -->
        <section class="min-h-screen w-full flex flex-col lg:flex-row justify-center items-center px-4 lg:px-6 relative pt-24 pb-12 gap-8 lg:gap-12 overflow-hidden">
            <!-- Animated Mesh Background -->
            <div class="hero-mesh-bg"></div>
            <!-- Floating Orbs -->
            <div class="hero-orb hero-orb--cyan"></div>
            <div class="hero-orb hero-orb--purple"></div>

            <div class="max-w-xl space-y-6 text-center lg:text-left relative z-10">
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm" style="animation: fadeSlideIn 0.8s ease-out 0.8s both;">
                    <span class="w-2 h-2 rounded-full bg-neon animate-pulse"></span>
                    <span class="text-neon text-xs font-medium tracking-widest uppercase">AI Creative Director &bull; No Signup Required</span>
                </div>
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-semibold tracking-tighter leading-none" style="animation: fadeSlideIn 0.8s ease-out 1s both;">
                    Your Commercial Brief<span class="text-neon">.</span>
                    <br><span class="text-white/50 font-serif italic font-normal">Built in Minutes.</span>
                </h1>
                <p class="text-base text-white/60 max-w-md mx-auto lg:mx-0" style="animation: fadeSlideIn 0.8s ease-out 1.2s both;">
                    Answer guided questions. Receive a production-ready brief optimized for AI video generation. No guesswork. No blank page.
                </p>
                <div class="space-y-3 text-left max-w-md mx-auto lg:mx-0" style="animation: fadeSlideIn 0.8s ease-out 1.3s both;">
                    <div class="flex items-center gap-3">
                        <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                        <span class="text-sm text-white/70">Structured 10-phase intake &mdash; we ask, you answer</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                        <span class="text-sm text-white/70">Captures offer, audience, hook, tone &amp; CTA</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                        <span class="text-sm text-white/70">Output ready for Veo, Runway &amp; AI production</span>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start pt-4" style="animation: fadeSlideIn 0.8s ease-out 1.4s both;">
                    <a href="#chat" onclick="focusChatInput()" class="cta-glow group relative px-8 py-4 bg-transparent overflow-hidden border border-neon text-white transition-all hover:border-neon cursor-pointer">
                        <div class="absolute inset-0 w-0 bg-neon transition-all duration-[250ms] ease-out group-hover:w-full opacity-80"></div>
                        <span class="relative flex items-center justify-center gap-3 text-sm font-medium uppercase tracking-widest group-hover:text-white">
                            Begin Your Brief
                            <i data-lucide="arrow-right" class="w-4 h-4" stroke-width="1.5"></i>
                        </span>
                    </a>
                    <a href="#how-it-works" class="group relative px-8 py-4 bg-transparent overflow-hidden border border-white/30 text-white transition-all hover:border-white/60">
                        <span class="relative flex items-center justify-center gap-3 text-sm font-medium uppercase tracking-widest">
                            See the Process
                        </span>
                    </a>
                </div>
            </div>

            <!-- Chat Widget -->
            <div id="chat" class="w-full max-w-xl lg:max-w-lg" style="animation: fadeSlideIn 0.8s ease-out 1.2s both;">
                <div class="relative p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-xl overflow-hidden group">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-50"></div>
                    <div class="absolute -top-24 -right-24 w-64 h-64 bg-neon/10 rounded-full blur-3xl pointer-events-none"></div>

                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-medium text-white tracking-tight">AI Creative Director</h3>
                                <p class="text-xs text-white/50 mt-1">I'll guide you through each step. Just answer naturally.</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span id="pipeline-badge" class="pipeline-badge hidden">6-AGENT</span>
                                <div class="flex items-center gap-2">
                                    <span class="relative flex h-2 w-2">
                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-2 w-2 bg-neon"></span>
                                    </span>
                                    <span id="status-text" class="text-xs text-neon uppercase tracking-wider font-medium">Ready</span>
                                </div>
                            </div>
                        </div>

                        <!-- Pipeline Phase Indicator -->
                        <div id="pipeline-phases" class="pipeline-phases hidden">
                            <span class="phase-dot active" data-phase="intake">Intake</span>
                            <span class="phase-dot" data-phase="research">Research</span>
                            <span class="phase-dot" data-phase="ideation">Concepts</span>
                            <span class="phase-dot" data-phase="script">Script</span>
                            <span class="phase-dot" data-phase="review">Review</span>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mb-4 p-3 rounded-lg bg-black/40 border border-white/5">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs text-white/50 uppercase tracking-wider">Brief Progress</span>
                                <span id="phase-tag" class="text-xs text-neon font-mono">Phase 1: Introduction</span>
                            </div>
                            <div class="w-full h-1.5 bg-white/10 rounded-full overflow-hidden">
                                <div id="progress-bar" class="h-full bg-gradient-to-r from-neon to-cyan-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between mt-1">
                                <span id="progress-percent" class="text-xs text-white/40 font-mono">0%</span>
                                <span id="completion-status" class="text-xs text-white/40">10 phases remaining</span>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div id="chat-messages" class="chat-container h-64 overflow-y-auto space-y-4 mb-4 pr-2">
                            <div class="flex gap-3">
                                <div class="w-8 h-8 rounded-full bg-neon/20 border border-neon/50 flex items-center justify-center flex-shrink-0">
                                    <i data-lucide="bot" class="w-4 h-4 text-neon" stroke-width="1.5"></i>
                                </div>
                                <div class="flex-1 p-3 rounded-lg bg-white/5 border border-white/10">
                                    <p class="text-sm text-white/80">Hello! I'm your AI Creative Director. Let's build your commercial brief together. What's your business name, and what product or service are we creating this commercial for?</p>
                                </div>
                            </div>
                        </div>

                        <!-- Concept Cards Container (for pipeline) -->
                        <div id="concept-cards" class="concept-cards hidden"></div>

                        <!-- Script Preview Container (for pipeline) -->
                        <div id="script-preview" class="script-preview hidden">
                            <div class="script-header">
                                <span> Your Script</span>
                                <span id="script-duration" class="script-duration"></span>
                            </div>
                            <div id="script-scenes" class="script-scenes"></div>
                            <div class="script-actions">
                                <button onclick="approveScript()" class="btn-approve"> Approve & Produce</button>
                                <button onclick="requestRevision()" class="btn-revise"> Revise</button>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div id="quick-actions" class="flex flex-wrap gap-2 mb-4 hidden"></div>

                        <!-- Error Message -->
                        <div id="error-container" class="hidden mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30">
                            <div class="flex items-center justify-between">
                                <span id="error-message" class="text-xs text-red-400"></span>
                                <button onclick="retryLastMessage()" class="text-xs text-red-400 hover:text-red-300 underline">Retry</button>
                            </div>
                        </div>

                        <!-- Attached Files Bar (populated by JS) -->
                        <div id="attached-files-bar"></div>
                        
                        <!-- Input -->
                        <div class="flex gap-3">
                            <input type="text" id="chat-input" placeholder="Type your answer here..." class="flex-1 bg-black/40 border border-white/10 rounded-lg px-4 py-3 text-sm text-white placeholder-white/30 focus:outline-none focus:border-neon/50 transition-colors" onkeypress="if(event.key==='Enter')sendMessage()">
                            
                            <button id="upload-btn" onclick="openUploadModal()" class="px-3 py-3 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 hover:border-neon/50 transition-all group relative" title="Upload Brand Assets for AI Analysis">
                                <svg class="w-5 h-5 text-white/50 group-hover:text-neon transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                </svg>
                                <span class="absolute -top-1 -right-1 flex h-3 w-3 hidden" id="upload-badge">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-3 w-3 bg-neon"></span>
                                </span>
                            </button>

                            <button id="send-btn" onclick="sendMessage()" class="px-4 py-3 bg-neon/20 border border-neon/50 rounded-lg hover:bg-neon/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="send" class="w-4 h-4 text-neon" stroke-width="1.5"></i>
                            </button>
                        </div>

                        <!-- FLAWLESS GENESIS Strategy Button (shows when qualification >= 0.8) -->
                        <div id="genesis-btn-container" class="mt-4 hidden">
                            <button id="genesis-strategy-btn" onclick="triggerGenesisStrategy()" class="w-full px-6 py-4 bg-gradient-to-r from-purple-600/30 to-neon/30 border border-purple-500/50 rounded-xl hover:from-purple-600/40 hover:to-neon/40 transition-all duration-300 group">
                                <div class="flex items-center justify-center gap-3">
                                    <span class="text-2xl group-hover:animate-pulse"></span>
                                    <div class="text-left">
                                        <div class="text-sm font-medium text-white">Generate AI Strategy</div>
                                        <div class="text-xs text-white/60">Launch FLAWLESS GENESIS Pipeline</div>
                                    </div>
                                    <i data-lucide="sparkles" class="w-5 h-5 text-purple-400 group-hover:text-neon transition-colors" stroke-width="1.5"></i>
                                </div>
                            </button>
                            <div class="mt-2 text-center">
                                <span class="text-xs text-white/40">Qualification Score: <span id="genesis-score-display" class="text-neon font-mono">0%</span></span>
                            </div>
                        </div>

                        <!-- FLAWLESS GENESIS Progress Container -->
                        <div id="genesis-container" class="mt-4 hidden">
                            <div class="p-4 rounded-xl bg-black/60 border border-purple-500/30">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-sm font-medium text-white"> FLAWLESS GENESIS</span>
                                    <span id="genesis-status-text" class="text-xs text-neon font-mono">INITIALIZING</span>
                                </div>

                                <!-- Progress Bar -->
                                <div class="h-2 bg-black/50 rounded-full overflow-hidden mb-3">
                                    <div id="genesis-progress-bar" class="h-full bg-gradient-to-r from-purple-600 to-neon transition-all duration-500 ease-out" style="width: 0%"></div>
                                </div>

                                <!-- Phase Text -->
                                <div id="genesis-phase-text" class="text-xs text-white/60 mb-4"></div>

                                <!-- Agent Grid -->
                                <div id="genesis-agent-panel" class="grid grid-cols-5 gap-2">
                                    <!-- Agents will be rendered here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- HOW IT WORKS -->
        <section id="how-it-works" class="flex flex-col z-10 w-full pt-24 px-6 pb-24 relative items-center">
            <div class="max-w-7xl mx-auto w-full space-y-12">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-b border-white/10 pb-8">
                    <div>
                        <span class="text-neon text-xs font-medium tracking-[0.2em] uppercase mb-2 block">The Process &bull; 3 Steps</span>
                        <h2 class="text-3xl md:text-5xl font-medium tracking-tight text-white max-w-2xl">
                            How It Works<span class="text-neon">.</span>
                            <br><span class="text-white/50">We guide. You answer. Done.</span>
                        </h2>
                    </div>
                    <p class="text-sm text-white/60 max-w-md text-right hidden md:block">
                        No blank prompts. No creative guesswork. Our AI walks you through a proven structure that captures everything production needs.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="group relative p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute inset-0 bg-gradient-to-b from-neon/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-[10px] uppercase tracking-widest text-white/40">Step One</span>
                                <span class="text-[10px] font-mono text-neon">01</span>
                            </div>
                            <div class="h-24 rounded-lg bg-black/50 border border-white/5 mb-6 flex items-center justify-center">
                                <i data-lucide="building-2" class="w-12 h-12 text-neon/50" stroke-width="1"></i>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-2">Define Your Business</h3>
                            <p class="text-xs text-white/50 leading-relaxed mb-4">Tell us your business name, what you offer, and the core value you deliver to customers.</p>
                            <div class="flex items-center gap-2 text-[10px] text-neon uppercase tracking-wider">
                                <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                                Phases 1&ndash;3
                            </div>
                        </div>
                    </div>

                    <div class="group relative p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute inset-0 bg-gradient-to-b from-neon/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-[10px] uppercase tracking-widest text-white/40">Step Two</span>
                                <span class="text-[10px] font-mono text-neon">02</span>
                            </div>
                            <div class="h-24 rounded-lg bg-black/50 border border-white/5 mb-6 flex items-center justify-center">
                                <i data-lucide="users" class="w-12 h-12 text-neon/50" stroke-width="1"></i>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-2">Identify Your Audience</h3>
                            <p class="text-xs text-white/50 leading-relaxed mb-4">Describe who you're speaking to, what problems they face, and what outcome they want.</p>
                            <div class="flex items-center gap-2 text-[10px] text-neon uppercase tracking-wider">
                                <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                                Phases 4&ndash;6
                            </div>
                        </div>
                    </div>

                    <div class="group relative p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute inset-0 bg-gradient-to-b from-neon/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-center mb-6">
                                <span class="text-[10px] uppercase tracking-widest text-white/40">Step Three</span>
                                <span class="text-[10px] font-mono text-neon">03</span>
                            </div>
                            <div class="h-24 rounded-lg bg-black/50 border border-white/5 mb-6 flex items-center justify-center">
                                <i data-lucide="sparkles" class="w-12 h-12 text-neon/50" stroke-width="1"></i>
                            </div>
                            <h3 class="text-lg font-medium text-white mb-2">Set the Creative Direction</h3>
                            <p class="text-xs text-white/50 leading-relaxed mb-4">Choose your tone, confirm your call-to-action, and receive your complete production brief.</p>
                            <div class="flex items-center gap-2 text-[10px] text-neon uppercase tracking-wider">
                                <div class="w-1.5 h-1.5 bg-neon rounded-full"></div>
                                Phases 7&ndash;10
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- WHAT YOU GET -->
        <section id="deliverables" class="min-h-screen w-full relative z-10 py-24 px-6 flex flex-col items-center">
            <div class="max-w-7xl mx-auto w-full">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-b border-white/10 pb-8 mb-12">
                    <div>
                        <span class="text-neon text-xs font-medium tracking-[0.2em] uppercase mb-2 block">Deliverables &bull; Your Output</span>
                        <h2 class="text-3xl md:text-5xl font-medium tracking-tight text-white max-w-2xl">
                            What You Receive<span class="text-neon">.</span>
                            <br><span class="text-white/50">Ready for production.</span>
                        </h2>
                    </div>
                    <p class="text-sm text-white/60 max-w-md text-right hidden md:block">
                        Your completed intake generates a comprehensive brief formatted for AI video tools and production teams.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="briefcase" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">Brand &amp; Offer Summary</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Clear articulation of your business identity, what you sell, and why it matters.</p>
                    </div>

                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="target" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">Target Audience Profile</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Detailed description of who you're reaching and the specific problems they need solved.</p>
                    </div>

                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="zap" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">Hook &amp; Call-to-Action</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Attention-grabbing opener and clear next step designed to drive viewer action.</p>
                    </div>

                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="palette" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">Tone &amp; Style Direction</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Creative guidance covering voice, pacing, and visual treatment for your commercial.</p>
                    </div>

                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="monitor-play" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">AI Video Optimization</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Brief structured for direct use with Veo, Runway, and other AI generation platforms.</p>
                    </div>

                    <div class="group p-6 rounded-2xl bg-white/5 border border-white/10 hover:border-neon/50 transition-colors backdrop-blur-sm relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-lg bg-neon/10 border border-neon/30 flex items-center justify-center">
                                <i data-lucide="file-text" class="w-5 h-5 text-neon" stroke-width="1.5"></i>
                            </div>
                            <h3 class="text-base font-medium text-white">Complete Brief Document</h3>
                        </div>
                        <p class="text-sm text-white/50 leading-relaxed">Everything consolidated into one production-ready document you can use immediately.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- TESTIMONIAL -->
        <section class="flex flex-col w-full py-24 px-6 relative z-10">
            <div class="max-w-7xl mx-auto w-full">
                <div class="border border-white/10 bg-white/5 backdrop-blur-xl rounded-3xl p-8 md:p-12 overflow-hidden relative group">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-neon to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="absolute -top-24 -right-24 w-96 h-96 bg-neon/10 rounded-full blur-3xl pointer-events-none"></div>
                    <div class="flex flex-col md:flex-row gap-12 relative z-10">
                        <div class="flex-1 flex flex-col justify-between">
                            <div>
                                <div class="text-neon text-xs font-medium tracking-[0.2em] uppercase mb-8">Early Feedback</div>
                                <h2 class="text-2xl md:text-4xl font-medium tracking-tight text-white mb-8 leading-snug">
                                    "I came in with a vague idea. The guided questions pulled out details I hadn't thought to include. Walked away with a brief I could actually hand to production."
                                </h2>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="h-12 w-12 rounded-full overflow-hidden ring-2 ring-white/10 bg-gradient-to-br from-neon/20 to-cyan-500/20 flex items-center justify-center">
                                    <i data-lucide="user" class="w-6 h-6 text-white/60" stroke-width="1.5"></i>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-white">Founder</div>
                                    <div class="text-xs text-white/40 uppercase tracking-wider">Local Services Company</div>
                                </div>
                            </div>
                        </div>
                        <div class="w-full md:w-80 bg-black/40 rounded-2xl p-6 border border-white/10 flex flex-col justify-center gap-6">
                            <div class="text-xs font-semibold tracking-widest text-white/30 uppercase">Intake Stats</div>
                            <div class="space-y-1">
                                <div class="text-4xl font-mono text-neon font-medium">10</div>
                                <div class="text-sm text-white/50">Guided Phases</div>
                            </div>
                            <div class="w-full h-px bg-white/10"></div>
                            <div class="space-y-1">
                                <div class="text-4xl font-mono text-neon font-medium">&lt;5min</div>
                                <div class="text-sm text-white/50">Average Completion</div>
                            </div>
                            <div class="w-full h-px bg-white/10"></div>
                            <div class="space-y-1">
                                <div class="text-4xl font-mono text-neon font-medium">100%</div>
                                <div class="text-sm text-white/50">Production Ready</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FINAL CTA -->
        <section class="w-full py-24 px-6 relative z-10">
            <div class="max-w-4xl mx-auto text-center">
                <span class="text-neon text-xs font-medium tracking-[0.2em] uppercase mb-4 block">No Signup Required</span>
                <h2 class="text-4xl md:text-6xl font-semibold tracking-tight text-white mb-6">
                    Start your brief<span class="text-neon">.</span>
                    <br><span class="font-serif italic font-normal text-white/50">Right now.</span>
                </h2>
                <p class="text-base text-white/60 max-w-xl mx-auto mb-8">
                    Just answer the questions. In a few minutes, you'll have a production-ready commercial brief &mdash; no account, no credit card, no friction.
                </p>
                <a href="#chat" onclick="focusChatInput()" class="inline-flex group relative px-10 py-4 bg-white text-black font-semibold uppercase tracking-widest text-xs hover:bg-neon hover:text-black transition-all duration-300 cursor-pointer">
                    <span class="relative z-10 flex items-center gap-3">
                        Begin Intake
                        <i data-lucide="arrow-right" class="w-4 h-4 transition-transform group-hover:translate-x-1" stroke-width="1.5"></i>
                    </span>
                </a>
            </div>
        </section>

        <!-- ========== UNIFIED FOOTER ========== -->
        <footer class="relative w-full bg-[#050508] pt-16 md:pt-24 pb-8 md:pb-12 px-4 md:px-6 border-t border-white/5 overflow-hidden">
    <!-- Volumetric Glow Background -->
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-[800px] h-[200px] bg-[#00CED1]/5 blur-[100px] rounded-full pointer-events-none"></div>

    <!-- Subtle Grid Pattern -->
    <div class="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:32px_32px] opacity-30 pointer-events-none"></div>

    <div class="max-w-7xl mx-auto relative z-10">

        <!-- Top Section: Brand + Tagline + Status -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12 md:mb-16 pb-8 md:pb-12 border-b border-white/5">
            <!-- Brand Block -->
            <div class="group">
                <a href="/" class="flex items-center gap-3 mb-3">
                    <img src="/brand/barrios-a2i-shard-logo.png" alt="Barrios A2I" class="w-10 h-10 md:w-12 md:h-12 object-contain opacity-90 group-hover:opacity-100 transition-opacity">
                    <h2 class="text-2xl md:text-3xl font-black tracking-tighter text-white transition-colors group-hover:text-[#00CED1]">
                        BARRIOS <span class="text-[#FFD700]">A2I</span>
                    </h2>
                </a>
                <p class="text-[#94a3b8] font-mono text-[10px] md:text-xs tracking-[0.2em] uppercase">
                    The Intelligence Architecture
                </p>
            </div>

            <!-- System Status Indicator -->
            <div class="flex items-center gap-3 px-4 py-2 bg-white/[0.03] backdrop-blur-sm border border-white/5 rounded-lg">
                <span class="relative flex h-2.5 w-2.5">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                </span>
                <span class="font-mono text-[10px] md:text-xs text-emerald-400 tracking-wider uppercase">All Systems Operational</span>
            </div>
        </div>

        <!-- Navigation Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-12 mb-12 md:mb-16">

            <!-- Products Column -->
            <div>
                <h4 class="font-mono text-[10px] md:text-xs text-[#00CED1] tracking-[0.15em] uppercase mb-4 md:mb-6 flex items-center gap-2">
                    <span class="text-[#00CED1]/40">[</span>
                    Products
                    <span class="text-[#00CED1]/40">]</span>
                </h4>
                <ul class="space-y-3">
                    <li>
                        <a href="/nexus-personal" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            NEXUS Personal
                        </a>
                    </li>
                    <li>
                        <a href="/creative-director" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Neural Ad Forge
                        </a>
                    </li>
                    <li>
                        <a href="/command-center" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Command Center
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Company Column -->
            <div>
                <h4 class="font-mono text-[10px] md:text-xs text-[#00CED1] tracking-[0.15em] uppercase mb-4 md:mb-6 flex items-center gap-2">
                    <span class="text-[#00CED1]/40">[</span>
                    Company
                    <span class="text-[#00CED1]/40">]</span>
                </h4>
                <ul class="space-y-3">
                    <li>
                        <a href="/#about" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            About
                        </a>
                    </li>
                    <li>
                        <a href="/contact" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Contact
                        </a>
                    </li>
                    <li>
                        <a href="/status" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            System Status
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Legal Column -->
            <div>
                <h4 class="font-mono text-[10px] md:text-xs text-[#00CED1] tracking-[0.15em] uppercase mb-4 md:mb-6 flex items-center gap-2">
                    <span class="text-[#00CED1]/40">[</span>
                    Legal
                    <span class="text-[#00CED1]/40">]</span>
                </h4>
                <ul class="space-y-3">
                    <li>
                        <a href="/privacy-directive" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Privacy Directive
                        </a>
                    </li>
                    <li>
                        <a href="/terms-of-service" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Terms of Service
                        </a>
                    </li>
                    <li>
                        <a href="/data-sovereignty" class="text-sm text-[#94a3b8] hover:text-white transition-colors duration-200 flex items-center gap-2 group">
                            <span class="w-1 h-1 bg-[#00CED1]/50 rounded-full group-hover:bg-[#00CED1] transition-colors"></span>
                            Data Sovereignty
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Connect Column -->
            <div>
                <h4 class="font-mono text-[10px] md:text-xs text-[#00CED1] tracking-[0.15em] uppercase mb-4 md:mb-6 flex items-center gap-2">
                    <span class="text-[#00CED1]/40">[</span>
                    Connect
                    <span class="text-[#00CED1]/40">]</span>
                </h4>
                <!-- Social Icons -->
                <div class="flex items-center gap-4 mb-6">
                    <a href="https://linkedin.com/company/barriosa2i" target="_blank" rel="noopener"
                       class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/[0.03] border border-white/5 text-[#94a3b8] hover:text-[#00CED1] hover:border-[#00CED1]/30 hover:bg-[#00CED1]/5 transition-all duration-200">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                    </a>
                    <a href="https://twitter.com/barriosa2i" target="_blank" rel="noopener"
                       class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/[0.03] border border-white/5 text-[#94a3b8] hover:text-[#00CED1] hover:border-[#00CED1]/30 hover:bg-[#00CED1]/5 transition-all duration-200">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    </a>
                    <a href="https://instagram.com/barriosa2i" target="_blank" rel="noopener"
                       class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/[0.03] border border-white/5 text-[#94a3b8] hover:text-[#00CED1] hover:border-[#00CED1]/30 hover:bg-[#00CED1]/5 transition-all duration-200">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                    </a>
                </div>
                <!-- Email -->
                <a href="mailto:contact@barriosa2i.com" class="text-sm text-[#94a3b8] hover:text-[#00CED1] transition-colors duration-200 font-mono">
                    contact@barriosa2i.com
                </a>
            </div>
        </div>

        <!-- Bottom Bar: Copyright -->
        <div class="flex flex-col md:flex-row justify-between items-center gap-4 pt-8 border-t border-white/5">
            <p class="font-mono text-[10px] md:text-xs text-[#64748b] tracking-wider">
                &copy; <span id="footer-year-cd">2025</span> BARRIOS A2I INC. ALL RIGHTS RESERVED.
            </p>
            <div class="flex items-center gap-6">
                <a href="/privacy-directive" class="font-mono text-[10px] md:text-xs text-[#64748b] hover:text-white transition-colors">Privacy</a>
                <a href="/terms-of-service" class="font-mono text-[10px] md:text-xs text-[#64748b] hover:text-white transition-colors">Terms</a>
                <a href="/data-sovereignty" class="font-mono text-[10px] md:text-xs text-[#64748b] hover:text-white transition-colors">Data</a>
            </div>
        </div>
    </div>
</footer>

<!-- Update year dynamically -->
<script>
    (function() {
        const yearEl = document.getElementById('footer-year-cd');
        if (yearEl) yearEl.textContent = new Date().getFullYear();
    })();
</script>
    </main>

    <!-- Three.js Background -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js"></script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        lucide.createIcons();

        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ReinhardToneMapping;
        container.appendChild(renderer.domElement);

        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0;
        bloomPass.strength = 2.0;
        bloomPass.radius = 0.5;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        const logoGroup = new THREE.Group();
        const material = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 1.0, roughness: 0.1, emissive: 0x004444, emissiveIntensity: 0.2 });
        const edgeMaterial = new THREE.MeshBasicMaterial({ color: 0x00F3FF });
        const geometry = new THREE.SphereGeometry(1.2, 32, 32);
        const mesh = new THREE.Mesh(geometry, material);
        const wireframe = new THREE.LineSegments(new THREE.EdgesGeometry(geometry), edgeMaterial);
        mesh.add(wireframe);
        logoGroup.add(mesh);
        scene.add(logoGroup);

        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);

        const spotlight1 = new THREE.SpotLight(0x00F3FF, 50);
        spotlight1.position.set(5, 5, 5);
        spotlight1.angle = 0.3;
        spotlight1.penumbra = 0.5;
        scene.add(spotlight1);

        const spotlight2 = new THREE.SpotLight(0xffffff, 10);
        spotlight2.position.set(-5, 5, 5);
        spotlight2.angle = 0.5;
        scene.add(spotlight2);

        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 2000;
        const posArray = new Float32Array(particlesCount * 3);
        for(let i = 0; i < particlesCount * 3; i++) { posArray[i] = (Math.random() - 0.5) * 20; }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.05, color: 0xffffff, transparent: true, opacity: 0.8 });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        particlesMesh.position.y = -5;
        scene.add(particlesMesh);

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.002;
            const scale = 1 + Math.sin(time * 2) * 0.02;
            logoGroup.scale.set(scale, scale, scale);
            logoGroup.rotation.y += 0.002;
            const positions = particlesGeometry.attributes.position.array;
            for(let i = 0; i < particlesCount; i++) {
                const x = positions[i * 3];
                positions[i * 3 + 1] = Math.sin(Date.now() * 0.001 + x) * 0.5 - 2;
            }
            particlesGeometry.attributes.position.needsUpdate = true;
            composer.render();
        }
        animate();

        gsap.registerPlugin(ScrollTrigger);
        const tl = gsap.timeline({ scrollTrigger: { trigger: "body", start: "top top", end: "bottom bottom", scrub: 1 } });
        tl.to(logoGroup.position, { z: -10, y: 5, duration: 2 }, 0)
          .to(logoGroup.rotation, { x: 1, duration: 2 }, 0)
          .to(camera.position, { z: 8, duration: 2 }, 0)
          .to(particlesMesh.position, { y: 0, duration: 2 }, 0.5)
          .to(particlesMaterial.color, { r: 0, g: 0.95, b: 1, duration: 1 }, 2)
          .to(camera.rotation, { z: 0.2, duration: 2 }, 2)
          .to(particlesMesh.scale, { x: 2, y: 2, z: 2, duration: 2 }, 4)
          .to(scene.fog, { density: 0.05, duration: 2 }, 4)
          .to(spotlight1, { intensity: 100, angle: 0.1, duration: 2 }, 6)
          .to(bloomPass, { strength: 3, radius: 1, duration: 2 }, 6);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

    <!-- Chat API Integration with 6-Agent Pipeline -->
    <script>
        const API_URL = 'https://barrios-creative-director.onrender.com';

        // Payment link (direct redirect, no API needed)
        const PAYMENT_LINK = 'https://buy.stripe.com/00w4gA84Ve498yF27HeME05';

        let sessionId = localStorage.getItem('barrios_creative_director_session');
        let isLoading = false;
        let lastMessage = '';
        let currentPhase = 1;

        // Pipeline state
        let PIPELINE_ENABLED = false;
        let pipelinePhase = 'intake';
        let concepts = [];
        let selectedConceptId = null;
        let currentScript = null;

        const PHASES = ['intake', 'research', 'ideation', 'script', 'review', 'production', 'delivery'];

        async function initSession() {
            try {
                // Try pipeline session first
                const pipelineRes = await fetch(`${API_URL}/api/legendary/session`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                if (pipelineRes.ok) {
                    const data = await pipelineRes.json();
                    sessionId = data.session_id;
                    localStorage.setItem('barrios_creative_director_session', sessionId);
                    PIPELINE_ENABLED = true;

                    // Show pipeline badge and phases
                    document.getElementById('pipeline-badge').classList.remove('hidden');
                    document.getElementById('pipeline-phases').classList.remove('hidden');
                    document.getElementById('status-text').textContent = '6-Agent Pipeline';
                    updatePhaseIndicator('intake');

                    if (data.greeting) {
                        const container = document.getElementById('chat-messages');
                        container.innerHTML = '';
                        addMessage(data.greeting, false, data.quick_actions || []);
                    }

                    console.log(' Pipeline session started:', sessionId);
                    return;
                }
            } catch (e) {
                console.log('Pipeline not available, falling back to basic session');
            }

            // Fallback to basic session
            try {
                const res = await fetch(`${API_URL}/api/session/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                if (!res.ok) throw new Error('Session start failed');
                const data = await res.json();
                sessionId = data.session_id;
                localStorage.setItem('barrios_creative_director_session', sessionId);

                if (data.greeting) {
                    const container = document.getElementById('chat-messages');
                    container.innerHTML = '';
                    addMessage(data.greeting, false, data.quick_actions || []);
                }

                if (data.phase) {
                    updateProgress(data.completion_percentage || 0, data.phase, false);
                }
            } catch (e) {
                console.error('Session init error:', e);
                showError('Unable to connect. Please refresh and try again.');
            }
        }

        function focusChatInput() {
            setTimeout(() => {
                document.getElementById('chat-input').focus();
            }, 300);
        }

        function showError(msg) {
            document.getElementById('error-container').classList.remove('hidden');
            document.getElementById('error-message').textContent = msg;
        }

        function hideError() {
            document.getElementById('error-container').classList.add('hidden');
        }

        function addMessage(content, isUser = false, quickActions = []) {
            const container = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex gap-3';

            if (isUser) {
                msgDiv.innerHTML = `
                    <div class="flex-1 p-3 rounded-lg bg-neon/10 border border-neon/30 ml-8">
                        <p class="text-sm text-white">${escapeHtml(content)}</p>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-white/10 border border-white/20 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="user" class="w-4 h-4 text-white/60" stroke-width="1.5"></i>
                    </div>
                `;
            } else {
                msgDiv.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-neon/20 border border-neon/50 flex items-center justify-center flex-shrink-0">
                        <i data-lucide="bot" class="w-4 h-4 text-neon" stroke-width="1.5"></i>
                    </div>
                    <div class="flex-1 p-3 rounded-lg bg-white/5 border border-white/10">
                        <p class="text-sm text-white/80">${escapeHtml(content)}</p>
                    </div>
                `;
            }

            container.appendChild(msgDiv);
            lucide.createIcons();
            container.scrollTop = container.scrollHeight;

            if (quickActions && quickActions.length > 0) {
                renderQuickActions(quickActions);
            } else {
                document.getElementById('quick-actions').classList.add('hidden');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function addTypingIndicator() {
            const container = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'flex gap-3';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-neon/20 border border-neon/50 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="bot" class="w-4 h-4 text-neon" stroke-width="1.5"></i>
                </div>
                <div class="flex-1 p-3 rounded-lg bg-white/5 border border-white/10">
                    <div class="typing-indicator flex gap-1">
                        <span class="w-2 h-2 bg-neon/60 rounded-full"></span>
                        <span class="w-2 h-2 bg-neon/60 rounded-full"></span>
                        <span class="w-2 h-2 bg-neon/60 rounded-full"></span>
                    </div>
                </div>
            `;
            container.appendChild(typingDiv);
            lucide.createIcons();
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        function renderQuickActions(actions) {
            const container = document.getElementById('quick-actions');
            container.innerHTML = '';
            container.classList.remove('hidden');

            actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = 'px-3 py-1.5 text-xs bg-white/5 border border-white/20 rounded-full text-white/70 hover:bg-neon/20 hover:border-neon/50 hover:text-neon transition-all';
                btn.textContent = action;
                btn.onclick = () => {
                    document.getElementById('chat-input').value = action;
                    sendMessage();
                };
                container.appendChild(btn);
            });
        }

        function updateProgress(percentage, phase, isComplete) {
            const bar = document.getElementById('progress-bar');
            const percent = document.getElementById('progress-percent');
            const phaseTag = document.getElementById('phase-tag');
            const status = document.getElementById('completion-status');

            const pct = Math.round(percentage * 100);
            bar.style.width = pct + '%';
            percent.textContent = pct + '%';

            if (phase) {
                currentPhase = phase;
                phaseTag.textContent = 'Phase ' + phase + ' of 10';
            }

            if (isComplete) {
                status.textContent = 'Brief Complete!';
                status.classList.add('text-neon');
                phaseTag.textContent = 'Complete';
            } else {
                const remaining = 10 - (currentPhase || 1);
                status.textContent = remaining + ' phase' + (remaining !== 1 ? 's' : '') + ' remaining';
            }
        }

        async function sendMessage() {
            if (isLoading) return;

            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            lastMessage = message;
            hideError();

            if (!sessionId) {
                await initSession();
                if (!sessionId) return;
            }

            addMessage(message, true);
            input.value = '';

            isLoading = true;
            document.getElementById('send-btn').disabled = true;
            addTypingIndicator();

            try {
                // Use pipeline or basic endpoint
                const endpoint = PIPELINE_ENABLED
                    ? `${API_URL}/api/legendary/message`
                    : `${API_URL}/api/chat`;

                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_id: sessionId, message })
                });

                if (!res.ok) throw new Error('Chat request failed');

                const data = await res.json();
                removeTypingIndicator();

                addMessage(data.response, false, data.quick_actions || []);

                // Track lead data for FLAWLESS GENESIS qualification
                updateLeadData(data);

                if (PIPELINE_ENABLED) {
                    // Handle pipeline phase transitions
                    if (data.phase) {
                        updatePhaseIndicator(data.phase);
                        pipelinePhase = data.phase;
                    }

                    // Trigger research when intake is complete
                    if (data.is_complete && pipelinePhase === 'intake') {
                        addSystemMessage(' Brief complete! Starting market research...');
                        await runResearchPhase();
                    }
                } else {
                    updateProgress(data.completion_percentage || 0, data.phase, data.is_complete);
                }

            } catch (e) {
                console.error('Chat error:', e);
                removeTypingIndicator();
                showError('Message failed to send. Please try again.');
            } finally {
                isLoading = false;
                document.getElementById('send-btn').disabled = false;
                input.focus();
            }
        }

        function retryLastMessage() {
            if (lastMessage) {
                document.getElementById('chat-input').value = lastMessage;
                sendMessage();
            }
        }

        // ============= PIPELINE PHASE FUNCTIONS =============

        async function runResearchPhase() {
            if (!PIPELINE_ENABLED) return;

            updatePhaseIndicator('research');
            addTypingIndicator();

            try {
                const res = await fetch(`${API_URL}/api/legendary/research/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                removeTypingIndicator();

                if (res.ok) {
                    const data = await res.json();
                    addSystemMessage(' Research complete! Analyzing market trends...');

                    if (data.insights) {
                        addMessage(data.insights, false);
                    }

                    // Auto-trigger ideation
                    setTimeout(() => runIdeationPhase(), 1000);
                }
            } catch (e) {
                removeTypingIndicator();
                console.error('Research phase error:', e);
            }
        }

        async function runIdeationPhase() {
            if (!PIPELINE_ENABLED) return;

            updatePhaseIndicator('ideation');
            addSystemMessage(' Generating creative concepts...');
            addTypingIndicator();

            try {
                const res = await fetch(`${API_URL}/api/legendary/ideation/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                removeTypingIndicator();

                if (res.ok) {
                    const data = await res.json();
                    concepts = data.concepts || [];

                    if (concepts.length > 0) {
                        addSystemMessage(' Here are your creative concepts:');
                        renderConceptCards(concepts);
                    } else {
                        addMessage(data.response || 'Concepts generated.', false);
                    }
                }
            } catch (e) {
                removeTypingIndicator();
                console.error('Ideation phase error:', e);
            }
        }

        async function selectConcept(conceptId) {
            if (!PIPELINE_ENABLED) return;

            selectedConceptId = conceptId;
            hideConceptCards();
            addSystemMessage(` Concept ${conceptId} selected!`);

            try {
                const res = await fetch(`${API_URL}/api/legendary/select-concept`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: sessionId,
                        concept_id: conceptId
                    })
                });

                if (res.ok) {
                    setTimeout(() => runScriptPhase(), 500);
                }
            } catch (e) {
                console.error('Concept selection error:', e);
            }
        }

        async function runScriptPhase() {
            if (!PIPELINE_ENABLED) return;

            updatePhaseIndicator('script');
            addSystemMessage(' Writing your commercial script...');
            addTypingIndicator();

            try {
                const res = await fetch(`${API_URL}/api/legendary/script/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                removeTypingIndicator();

                if (res.ok) {
                    const data = await res.json();
                    currentScript = data.script;

                    if (currentScript) {
                        renderScriptPreview(currentScript);
                    } else {
                        addMessage(data.response || 'Script generated.', false);
                    }
                }
            } catch (e) {
                removeTypingIndicator();
                console.error('Script phase error:', e);
            }
        }

        async function runReviewPhase() {
            if (!PIPELINE_ENABLED) return;

            updatePhaseIndicator('review');
            addSystemMessage(' Running compliance review...');
            addTypingIndicator();

            try {
                const res = await fetch(`${API_URL}/api/legendary/review/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                removeTypingIndicator();

                if (res.ok) {
                    const data = await res.json();
                    addMessage(data.response || ' Review complete!', false);

                    if (data.approved) {
                        updatePhaseIndicator('production');
                        addSystemMessage(' Your commercial is ready for production!');
                        showPricingOptions();
                    }
                }
            } catch (e) {
                removeTypingIndicator();
                console.error('Review phase error:', e);
            }
        }

        async function approveScript() {
            if (!currentScript) return;

            document.getElementById('script-preview').classList.add('hidden');
            addSystemMessage(' Script approved! Starting review...');
            await runReviewPhase();
        }

        async function requestRevision() {
            document.getElementById('script-preview').classList.add('hidden');
            addMessage("I'd like to revise the script. What changes would you like?", false);
        }

        function showPricingOptions() {
            const container = document.getElementById('chat-messages');
            const pricingDiv = document.createElement('div');
            pricingDiv.className = 'pricing-options mt-4 p-4 bg-gradient-to-r from-neon/10 to-transparent border border-neon/30 rounded-lg';
            pricingDiv.innerHTML = `
                <div class="text-neon font-mono text-xs mb-3">[ READY FOR PRODUCTION ]</div>
                <div class="p-4 bg-gradient-to-r from-brand-gold/20 to-neon/10 border border-brand-gold/50 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-white font-semibold text-lg">Neural Ad Forge</span>
                        <span class="text-brand-gold font-mono text-xl">$499</span>
                    </div>
                    <p class="text-white/60 text-sm mb-4">AI-generated commercial with your approved script</p>
                    <ul class="text-white/50 text-xs space-y-1 mb-4">
                        <li> 30-second broadcast-quality commercial</li>
                        <li> Professional AI voiceover</li>
                        <li> Music & sound design</li>
                        <li> 2 revision rounds</li>
                        <li> Delivered in 48-72 hours</li>
                    </ul>
                    <button onclick="proceedToCheckout()" class="w-full py-3 bg-brand-gold text-black font-bold text-sm uppercase rounded hover:bg-white transition-colors">
                        Proceed to Checkout 
                    </button>
                </div>
                <p class="text-center text-white/40 text-xs mt-3">Secure payment powered by Stripe</p>
            `;
            container.appendChild(pricingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function proceedToCheckout() {
            addSystemMessage(' Redirecting to secure checkout...');

            // Append session_id to payment link for tracking
            const checkoutUrl = sessionId
                ? `${PAYMENT_LINK}?client_reference_id=${sessionId}`
                : PAYMENT_LINK;

            // Small delay so user sees the message
            setTimeout(() => {
                window.location.href = checkoutUrl;
            }, 500);
        }

        // ============= RENDER FUNCTIONS =============

        function renderConceptCards(conceptsArray) {
            const container = document.getElementById('concept-cards');
            container.innerHTML = '';
            container.classList.remove('hidden');

            conceptsArray.forEach((concept, idx) => {
                const card = document.createElement('div');
                card.className = 'concept-card';
                card.onclick = () => selectConcept(concept.id || idx + 1);

                card.innerHTML = `
                    <div class="concept-title">${concept.title || 'Concept ' + (idx + 1)}</div>
                    <div class="concept-description">${concept.description || concept.hook || ''}</div>
                    ${concept.score ? `<div class="concept-score">Score: ${concept.score}/100</div>` : ''}
                `;

                container.appendChild(card);
            });
        }

        function hideConceptCards() {
            document.getElementById('concept-cards').classList.add('hidden');
        }

        function renderScriptPreview(script) {
            const container = document.getElementById('script-preview');
            container.classList.remove('hidden');

            const duration = document.getElementById('script-duration');
            duration.textContent = script.duration || '30s';

            const scenesContainer = document.getElementById('script-scenes');
            scenesContainer.innerHTML = '';

            if (script.scenes) {
                script.scenes.forEach((scene, idx) => {
                    const sceneDiv = document.createElement('div');
                    sceneDiv.className = 'scene';
                    sceneDiv.innerHTML = `
                        <div class="scene-number">Scene ${idx + 1}</div>
                        <div class="scene-visual">${scene.visual || ''}</div>
                        <div class="scene-audio">${scene.voiceover || scene.audio || ''}</div>
                    `;
                    scenesContainer.appendChild(sceneDiv);
                });
            } else if (script.content) {
                scenesContainer.innerHTML = `<div class="scene">${script.content}</div>`;
            }
        }

        function updatePhaseIndicator(phase) {
            const phases = document.querySelectorAll('.phase-dot');
            const phaseIndex = PHASES.indexOf(phase);

            phases.forEach((dot, idx) => {
                dot.classList.remove('active', 'completed');
                if (idx < phaseIndex) {
                    dot.classList.add('completed');
                } else if (idx === phaseIndex) {
                    dot.classList.add('active');
                }
            });
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'system-message';
            msgDiv.innerHTML = `<span class="system-icon"></span>${text}`;
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Check for canceled checkout
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('canceled') === 'true') {
                // Clean up URL
                window.history.replaceState({}, '', window.location.pathname);
                // Show message after chat initializes
                setTimeout(() => {
                    addSystemMessage(' Checkout canceled. Your brief is still saved. Select a plan when ready.');
                }, 2000);
            }

            // Start fresh session for clean state
            initSession();
        });

        // =============================================================================
        // NEXUS BRIDGE INTEGRATION
        // =============================================================================

        let productionClient = null;

        /**
         * Show the Start Production button after brief approval
         * Hook this into your existing brief approval handler
         */
        function showStartProductionButton() {
            const btn = document.getElementById('start-production-btn');
            if (btn) {
                btn.style.display = 'inline-block';
                // Scroll to make button visible
                btn.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        /**
         * Start legendary production pipeline with NEXUS BRIDGE
         */
        async function startLegendaryProduction() {
            // Get session ID from your existing session management
            const sessionId = window.currentSessionId ||
                              localStorage.getItem('creative_session_id') ||
                              sessionStorage.getItem('session_id');

            if (!sessionId) {
                alert('No session found. Please complete the intake process first.');
                return;
            }

            console.log(' Starting legendary production for session:', sessionId);

            // Hide start button
            const btn = document.getElementById('start-production-btn');
            if (btn) btn.style.display = 'none';

            // Show production container
            const container = document.getElementById('production-container');
            if (container) {
                container.style.display = 'block';
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Initialize production with the global function from nexus_sse_client.js
            // This function creates the progress bar UI and starts SSE streaming
            if (typeof initLegendaryProduction === 'function') {
                productionClient = initLegendaryProduction(sessionId);
            } else {
                console.error('initLegendaryProduction not available from nexus_sse_client.js');
            }
        }

        /**
         * Cancel production (emergency stop)
         */
        async function cancelProduction() {
            if (productionClient) {
                const confirmed = confirm('Are you sure you want to cancel? Costs incurred cannot be refunded.');
                if (confirmed) {
                    productionClient.cancel('User requested cancellation');
                }
            }
        }

        // =============================================================================
        // FLAWLESS GENESIS ORCHESTRATOR INTEGRATION
        // =============================================================================

        const GENESIS_API_URL = 'https://barrios-genesis-flawless.onrender.com';
        let genesisPipelineId = null;
        let genesisEventSource = null;
        let genesisStatus = 'idle'; // idle, loading, running, complete, error

        // Collected lead data from intake
        let collectedLeadData = {
            businessName: '',
            industry: '',
            goals: [],
            painPoints: [],
            targetAudience: '',
            score: 0
        };

        /**
         * Update lead data from chat responses
         * Call this after successful chat responses to track qualification
         */
        function updateLeadData(responseData) {
            if (responseData.extracted_data) {
                const data = responseData.extracted_data;
                if (data.business_name) collectedLeadData.businessName = data.business_name;
                if (data.industry) collectedLeadData.industry = data.industry;
                if (data.goals) collectedLeadData.goals = data.goals;
                if (data.pain_points) collectedLeadData.painPoints = data.pain_points;
                if (data.target_audience) collectedLeadData.targetAudience = data.target_audience;
            }

            // Calculate qualification score based on collected data
            let score = 0;
            if (collectedLeadData.businessName) score += 0.2;
            if (collectedLeadData.industry) score += 0.2;
            if (collectedLeadData.goals.length > 0) score += 0.2;
            if (collectedLeadData.painPoints.length > 0) score += 0.2;
            if (collectedLeadData.targetAudience) score += 0.2;
            collectedLeadData.score = score;

            // Show Genesis button if score >= 0.8
            updateGenesisButtonVisibility();
        }

        /**
         * Show/hide Genesis strategy button based on qualification
         */
        function updateGenesisButtonVisibility() {
            const container = document.getElementById('genesis-btn-container');
            const scoreDisplay = document.getElementById('genesis-score-display');
            if (!container) return;

            // Update score display
            if (scoreDisplay) {
                scoreDisplay.textContent = Math.round(collectedLeadData.score * 100) + '%';
            }

            if (collectedLeadData.score >= 0.8 && genesisStatus === 'idle') {
                container.classList.remove('hidden');
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else if (genesisStatus !== 'running') {
                container.classList.add('hidden');
            }
        }

        /**
         * Trigger FLAWLESS GENESIS pipeline
         */
        async function triggerGenesisStrategy() {
            if (genesisStatus === 'loading' || genesisStatus === 'running') return;

            const btn = document.getElementById('genesis-strategy-btn');
            const container = document.getElementById('genesis-container');

            genesisStatus = 'loading';
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = ' Initializing Genesis...';
            }

            try {
                const response = await fetch(`${GENESIS_API_URL}/api/genesis/trigger`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: sessionId,
                        business_name: collectedLeadData.businessName,
                        industry: collectedLeadData.industry,
                        goals: collectedLeadData.goals,
                        pain_points: collectedLeadData.painPoints,
                        target_audience: collectedLeadData.targetAudience,
                        qualification_score: collectedLeadData.score,
                        generate_video: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`Genesis trigger failed: ${response.status}`);
                }

                const data = await response.json();
                genesisPipelineId = data.pipeline_id;
                genesisStatus = 'running';

                // Hide button container, show progress container
                const btnContainer = document.getElementById('genesis-btn-container');
                if (btnContainer) btnContainer.classList.add('hidden');
                if (container) {
                    container.classList.remove('hidden');
                    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                // Connect to SSE stream
                connectToGenesisStream(genesisPipelineId);

                addSystemMessage(' FLAWLESS GENESIS initiated! Our AI agents are crafting your strategy...');

            } catch (error) {
                console.error('Genesis trigger error:', error);
                genesisStatus = 'error';
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = ' Generate AI Strategy';
                }
                addSystemMessage(' Genesis initialization failed. Please try again.');
            }
        }

        /**
         * Connect to Genesis SSE stream for real-time updates
         */
        function connectToGenesisStream(pipelineId) {
            if (genesisEventSource) {
                genesisEventSource.close();
            }

            const streamUrl = `${GENESIS_API_URL}/api/genesis/stream/${pipelineId}`;
            genesisEventSource = new EventSource(streamUrl);

            genesisEventSource.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    handleGenesisEvent(data);
                } catch (e) {
                    console.error('Genesis event parse error:', e);
                }
            };

            genesisEventSource.onerror = (error) => {
                console.error('Genesis SSE error:', error);
                genesisEventSource.close();
                if (genesisStatus === 'running') {
                    addSystemMessage(' Connection lost. Attempting to reconnect...');
                    setTimeout(() => connectToGenesisStream(pipelineId), 2000);
                }
            };
        }

        /**
         * Handle incoming Genesis pipeline events
         */
        function handleGenesisEvent(data) {
            const progressBar = document.getElementById('genesis-progress-bar');
            const phaseText = document.getElementById('genesis-phase-text');
            const statusText = document.getElementById('genesis-status-text');
            const agentPanel = document.getElementById('genesis-agent-panel');

            // Update progress bar
            if (data.progress !== undefined && progressBar) {
                progressBar.style.width = `${data.progress}%`;
            }
            // Update status text
            if (data.status && statusText) {
                statusText.textContent = data.status.toUpperCase();
            }
            // Update phase text
            if (data.stage && phaseText) {
                phaseText.textContent = `Stage: ${data.stage.replace(/_/g, ' ').toUpperCase()} ${data.message ? ' ' + data.message : ''}`;
            } else if (data.message && phaseText) {
                phaseText.textContent = data.message;
            }

            // Render agent card
            if (data.agent && agentPanel) {
                renderGenesisAgentCard(agentPanel, data);
            }

            // Handle completion
            if (data.event === 'pipeline_complete' || data.event === 'complete') {
                genesisStatus = 'complete';
                genesisEventSource.close();
                addSystemMessage(' FLAWLESS GENESIS complete! Your AI strategy is ready.');
                renderGenesisComplete(data.result);
            }

            // Handle errors
            if (data.event === 'pipeline_error' || data.event === 'error') {
                genesisStatus = 'error';
                genesisEventSource.close();
                addSystemMessage(` Genesis error: ${data.error || 'Unknown error'}`);
            }
        }

        /**
         * Render Genesis agent progress card
         */
        function renderGenesisAgentCard(container, data) {
            const agents = {
                trend_scout: { name: 'Trend Scout', icon: '', color: '#00C2FF' },
                market_analyst: { name: 'Market Analyst', icon: '', color: '#A855F7' },
                competitor_tracker: { name: 'Competitor', icon: '', color: '#FF6B6B' },
                strategy_synthesizer: { name: 'Synthesizer', icon: '', color: '#FFD700' },
                ragnarok: { name: 'RAGNAROK', icon: '', color: '#10B981' }
            };

            const agentConfig = agents[data.agent] || { name: data.agent, icon: '', color: '#00CED1' };
            const isComplete = data.status === 'complete' || data.status === 'success';
            const isRunning = data.status === 'running' || data.status === 'processing';

            // Check if card for this agent already exists
            let card = document.getElementById(`genesis-agent-${data.agent}`);
            if (!card) {
                card = document.createElement('div');
                card.id = `genesis-agent-${data.agent}`;
                card.className = 'genesis-agent-card';
                container.appendChild(card);
            }

            card.style.cssText = `
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
                padding: 8px;
                background: ${isComplete ? 'rgba(16, 185, 129, 0.1)' : isRunning ? `${agentConfig.color}15` : 'rgba(255,255,255,0.03)'};
                border: 1px solid ${isComplete ? 'rgba(16, 185, 129, 0.3)' : isRunning ? `${agentConfig.color}40` : 'rgba(255,255,255,0.1)'};
                border-radius: 8px;
                transition: all 0.3s ease;
            `;
            card.innerHTML = `
                <span style="font-size: 20px; ${isRunning ? 'animation: pulse 1s infinite;' : ''}">${agentConfig.icon}</span>
                <div style="font-size: 9px; font-weight: bold; color: ${isComplete ? '#10B981' : isRunning ? agentConfig.color : 'rgba(255,255,255,0.5)'}; text-transform: uppercase; letter-spacing: 0.3px; text-align: center;">
                    ${agentConfig.name}
                </div>
                <span style="font-size: 12px;">${isComplete ? '' : isRunning ? '' : ''}</span>
            `;
        }

        /**
         * Render Genesis completion summary
         */
        function renderGenesisComplete(result) {
            const container = document.getElementById('genesis-container');
            if (!container || !result) return;

            const summary = document.createElement('div');
            summary.style.cssText = `
                margin-top: 16px;
                padding: 20px;
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(0, 206, 209, 0.1));
                border: 1px solid rgba(16, 185, 129, 0.4);
                border-radius: 12px;
                text-align: center;
            `;
            summary.innerHTML = `
                <div style="font-size: 32px; margin-bottom: 12px;">  </div>
                <div style="font-size: 16px; font-weight: bold; color: #10B981; margin-bottom: 8px;">
                    FLAWLESS GENESIS COMPLETE!
                </div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.7);">
                    Your AI-powered strategy and commercial are ready.
                </div>
            `;
            container.appendChild(summary);
        }
    </script>

    <!-- NEXUS Agent Visuals Mount Points -->
    <div id="nexus-explain-strip"></div>

    <!-- NEXUS BRIDGE Production Pipeline Container -->
    <div id="production-container" class="production-pipeline" style="
        display: none;
        margin-top: 24px;
        padding: 24px;
        background: linear-gradient(135deg, rgba(0, 206, 209, 0.05), rgba(139, 0, 139, 0.05));
        border: 1px solid rgba(0, 206, 209, 0.3);
        border-radius: 16px;
    ">
        <!-- Agent Panel will be inserted here by agent-visuals-integration.js -->
        <div id="nexus-agent-panel" style="margin-top: 16px;"></div>
    </div>

    <!-- Start Production Button (shown after brief approval) -->
    <button
        id="start-production-btn"
        onclick="startLegendaryProduction()"
        style="
            display: none;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000;
            border: none;
            padding: 16px 32px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 16px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        "
        onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(255, 215, 0, 0.4)';"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 215, 0, 0.3)';"
    >
         START LEGENDARY PRODUCTION
    </button>

    <!-- ==================================================================================
         FLAWLESS GENESIS - STRATEGY RESULTS MODAL
         ================================================================================== -->
    <div id="genesis-results-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-void/80 backdrop-blur-md transition-opacity duration-300 opacity-0" id="modal-backdrop"></div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-[#0a0a1e]/90 border border-white/10 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 duration-300" id="modal-panel">

                    <!-- Modal Header -->
                    <div class="relative bg-white/5 px-4 py-6 sm:px-6 border-b border-white/10 backdrop-blur-xl">
                        <div class="absolute top-0 right-0 pt-4 pr-4">
                            <button type="button" onclick="closeStrategyModal()" class="rounded-md bg-transparent text-white/40 hover:text-white focus:outline-none transition-colors">
                                <span class="sr-only">Close</span>
                                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-purple-600/20 to-neon/20 border border-white/10 shadow-lg shadow-purple-500/10">
                                <span class="text-2xl animate-pulse"></span>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold leading-6 text-white tracking-tight" id="modal-title">Genesis Strategy Report</h3>
                                <p class="mt-1 text-sm text-white/60">AI-generated growth roadmap for <span id="modal-business-name" class="text-neon font-semibold">Your Business</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Body -->
                    <div class="px-4 py-6 sm:p-8 space-y-8 bg-gradient-to-b from-[#0a0a1e] to-black max-h-[60vh] overflow-y-auto">

                        <!-- Market Insights Section -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-neon uppercase tracking-widest flex items-center gap-2">
                                <span></span> Market Insights
                            </h4>
                            <div id="modal-market-insights" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Competitive Position Section -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-purple-400 uppercase tracking-widest flex items-center gap-2">
                                <span></span> Competitive Position
                            </h4>
                            <div class="relative pt-2 px-4 py-4 rounded-xl bg-white/5 border border-white/5">
                                <div class="flex mb-2 items-center justify-between">
                                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-purple-200 bg-purple-500/20 border border-purple-500/30">
                                        Market Gap
                                    </span>
                                    <span id="modal-competitor-gap" class="text-xs font-bold inline-block text-purple-300">
                                        Calculating...
                                    </span>
                                </div>
                                <div class="overflow-hidden h-2 mb-3 text-xs flex rounded-full bg-white/10">
                                    <div id="modal-competitor-bar" style="width: 0%" class="shadow-lg shadow-purple-500/50 flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-purple-600 to-purple-400 transition-all duration-1000 ease-out"></div>
                                </div>
                                <p id="modal-competitor-text" class="text-sm text-white/70 italic leading-relaxed">Analyzing competitor saturation...</p>
                            </div>
                        </div>

                        <!-- Strategic Recommendations Section -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-amber-400 uppercase tracking-widest flex items-center gap-2">
                                <span></span> Strategic Recommendations
                            </h4>
                            <ul id="modal-recommendations" class="space-y-3">
                                <!-- Populated by JS -->
                            </ul>
                        </div>

                        <!-- Action Items Section -->
                        <div class="space-y-4">
                            <h4 class="text-xs font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                                <span></span> Next Steps
                            </h4>
                            <div id="modal-action-items" class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                    </div>

                    <!-- Modal Footer CTAs -->
                    <div class="bg-[#050510] px-4 py-5 sm:px-6 sm:flex sm:flex-row-reverse gap-3 border-t border-white/10">
                        <button type="button" onclick="bookStrategyCall()" class="w-full inline-flex justify-center items-center rounded-xl border border-transparent bg-gradient-to-r from-purple-600 to-neon px-4 py-3 text-sm font-bold text-white shadow-lg shadow-purple-500/20 hover:shadow-purple-500/40 hover:from-purple-500 hover:to-neon/90 focus:outline-none sm:ml-3 sm:w-auto transition-all duration-300 transform hover:-translate-y-0.5">
                            <span class="mr-2"></span> Book Strategy Call
                        </button>
                        <button type="button" onclick="downloadStrategyPDF()" class="mt-3 w-full inline-flex justify-center items-center rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-white/10 hover:border-white/20 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto transition-all duration-200">
                            <span class="mr-2"></span> Download PDF
                        </button>
                        <button type="button" onclick="shareStrategy()" class="mt-3 w-full inline-flex justify-center items-center rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-white/10 hover:border-white/20 focus:outline-none sm:mt-0 sm:w-auto transition-all duration-200">
                            <span class="mr-2"></span> Share
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================================================================================
        // STRATEGY MODAL LOGIC (FLAWLESS GENESIS)
        // ==================================================================================

        function showStrategyModal(data) {
            const modal = document.getElementById('genesis-results-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const panel = document.getElementById('modal-panel');

            if (!modal || !backdrop || !panel) {
                console.error('Strategy modal elements not found');
                return;
            }

            // Populate Business Name
            if (data && data.lead && data.lead.business_name) {
                document.getElementById('modal-business-name').textContent = data.lead.business_name;
            } else if (typeof collectedLeadData !== 'undefined' && collectedLeadData.businessName) {
                document.getElementById('modal-business-name').textContent = collectedLeadData.businessName;
            }

            // 1. Market Insights
            const insightsContainer = document.getElementById('modal-market-insights');
            insightsContainer.innerHTML = '';
            const insights = (data && data.strategy && data.strategy.market_insights)
                ? data.strategy.market_insights
                : (data && data.result && data.result.market_insights)
                    ? data.result.market_insights
                    : [
                        "Market demand is growing in your sector by 12% YoY based on recent search volume.",
                        "Competitors are currently under-utilizing short-form video marketing channels.",
                        "AI-generated content is showing 3x higher engagement rates in your vertical.",
                        "Mobile-first video consumption has increased 47% in your target demographic."
                    ];
            insights.forEach(text => {
                const div = document.createElement('div');
                div.className = 'p-4 rounded-xl bg-white/5 border border-white/10 hover:border-neon/30 transition-all duration-300 hover:bg-white/10';
                div.innerHTML = '<p class="text-sm text-white/80 leading-relaxed">"' + text + '"</p>';
                insightsContainer.appendChild(div);
            });

            // 2. Competitor Analysis
            const compScore = (data && data.strategy && data.strategy.competitor_score)
                ? data.strategy.competitor_score
                : (data && data.result && data.result.competitor_score)
                    ? data.result.competitor_score
                    : 75;
            setTimeout(() => {
                document.getElementById('modal-competitor-bar').style.width = compScore + '%';
            }, 500);
            document.getElementById('modal-competitor-gap').textContent = (100 - compScore) + '% Opportunity';

            const compText = (data && data.strategy && data.strategy.competitor_analysis)
                ? data.strategy.competitor_analysis
                : (data && data.result && data.result.competitor_analysis)
                    ? data.result.competitor_analysis
                    : 'Your competitors have significant gaps in video content strategy, creating a prime opportunity for market differentiation.';
            document.getElementById('modal-competitor-text').textContent = compText;

            // 3. Strategic Recommendations
            const recList = document.getElementById('modal-recommendations');
            recList.innerHTML = '';
            const recs = (data && data.strategy && data.strategy.recommendations)
                ? data.strategy.recommendations
                : (data && data.result && data.result.recommendations)
                    ? data.result.recommendations
                    : [
                        "Launch a 30s hook-based video on Instagram Reels to target the 25-34 demographic.",
                        "Target lookalike audiences of your top 2 competitors using 'Speed' as the core hook.",
                        "Focus messaging on convenience to differentiate from legacy providers.",
                        "Implement retargeting funnel with sequential video content."
                    ];
            recs.forEach(rec => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-3 p-3 rounded-lg bg-amber-500/5 border border-amber-500/10 hover:bg-amber-500/10 transition-colors';
                li.innerHTML = '<div class="mt-0.5 min-w-[20px] text-amber-400"></div><span class="text-sm text-white/90">' + rec + '</span>';
                recList.appendChild(li);
            });

            // 4. Action Items
            const actionContainer = document.getElementById('modal-action-items');
            actionContainer.innerHTML = '';
            const actions = (data && data.strategy && data.strategy.action_items)
                ? data.strategy.action_items
                : (data && data.result && data.result.action_items)
                    ? data.result.action_items
                    : ["Approve Script", "Select Voiceover", "Launch Campaign"];
            actions.forEach((action, idx) => {
                const actionText = typeof action === 'string' ? action : action.text;
                const div = document.createElement('div');
                div.className = 'p-4 rounded-lg bg-emerald-500/5 border border-emerald-500/10 text-center hover:bg-emerald-500/10 transition-colors cursor-default';
                div.innerHTML = '<span class="text-[10px] text-emerald-400 font-bold block mb-1 tracking-wider">STEP ' + (idx + 1) + '</span><span class="text-sm text-white font-medium">' + actionText + '</span>';
                actionContainer.appendChild(div);
            });

            // Show Modal with Animation
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // Trigger reflow for animation
            void modal.offsetWidth;

            backdrop.classList.remove('opacity-0');
            backdrop.classList.add('opacity-100');
            panel.classList.remove('opacity-0', 'translate-y-4', 'sm:scale-95');
            panel.classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
        }

        function closeStrategyModal() {
            const modal = document.getElementById('genesis-results-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const panel = document.getElementById('modal-panel');

            if (!modal || !backdrop || !panel) return;

            // Animate out
            backdrop.classList.remove('opacity-100');
            backdrop.classList.add('opacity-0');
            panel.classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
            panel.classList.add('opacity-0', 'translate-y-4', 'sm:scale-95');

            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        function downloadStrategyPDF() {
            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="mr-2 animate-spin"></span> Generating...';

            setTimeout(() => {
                btn.innerHTML = '<span class="mr-2"></span> Downloaded';
                btn.classList.add('text-emerald-400', 'border-emerald-500/50');

                // Show toast notification
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-4 right-4 bg-emerald-500/20 border border-emerald-500/30 text-emerald-300 px-6 py-3 rounded-xl z-[9999] animate-pulse';
                toast.textContent = ' Strategy PDF will be emailed to you shortly!';
                document.body.appendChild(toast);

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('text-emerald-400', 'border-emerald-500/50');
                    toast.remove();
                }, 3000);
            }, 1500);
        }

        function shareStrategy() {
            if (navigator.share) {
                navigator.share({
                    title: 'My Genesis Strategy',
                    text: 'Check out this AI-generated video strategy from Barrios A2I!',
                    url: window.location.href
                });
            } else {
                const btn = event.currentTarget;
                const originalText = btn.innerHTML;
                navigator.clipboard.writeText(window.location.href);
                btn.innerHTML = '<span class="mr-2"></span> Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }
        }

        function bookStrategyCall() {
            window.open('https://calendly.com/gary-barrios/strategy', '_blank');
        }

        // Close modal on backdrop click
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'modal-backdrop') {
                closeStrategyModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('genesis-results-modal');
                if (modal && !modal.classList.contains('hidden')) {
                    closeStrategyModal();
                }
            }
        });

        // ==================================================================================
        // PIPELINE HOOK - Override renderGenesisComplete to auto-open modal
        // ==================================================================================
        (function() {
            const _prevRenderComplete = window.renderGenesisComplete;
            window.renderGenesisComplete = function(data) {
                // Call original (shows in-page banner)
                if (_prevRenderComplete) {
                    _prevRenderComplete(data);
                }

                // Auto-open modal after 1.5s delay for smooth UX
                setTimeout(function() {
                    showStrategyModal(data || {});
                }, 1500);
            };
        })();
    </script>

    <!-- ========================================================================
         FLAWLESS GENESIS - ASSET UPLOAD SYSTEM
         All agents collaborate to analyze uploads and create commercials
         ======================================================================== -->
    <div id="file-upload-modal" class="fixed inset-0 z-[60] hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/80 backdrop-blur-md transition-opacity duration-300 opacity-0" id="upload-modal-backdrop"></div>
        
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4">
                <div class="relative w-full max-w-2xl transform overflow-hidden rounded-2xl bg-[#0a0a1e]/95 border border-white/10 shadow-[0_0_50px_rgba(0,206,209,0.1)] transition-all opacity-0 scale-95 duration-300" id="upload-modal-panel">
                    
                    <!-- Modal Header -->
                    <div class="relative px-6 py-4 border-b border-white/10 bg-white/5 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-neon/20 to-purple-500/20 border border-neon/30 flex items-center justify-center shadow-[0_0_15px_rgba(0,243,255,0.2)]">
                                <span class="text-xl"></span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white tracking-tight">Upload Brand Assets</h3>
                                <p class="text-xs text-white/50 font-mono">LOGOS  PRODUCT SHOTS  BRAND GUIDES</p>
                            </div>
                        </div>
                        <button type="button" onclick="closeUploadModal()" class="text-white/40 hover:text-white hover:rotate-90 transition-all duration-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>
                    
                    <!-- Agent Integration Notice -->
                    <div class="px-6 py-3 bg-gradient-to-r from-neon/5 to-purple-500/5 border-b border-white/5">
                        <div class="flex items-center gap-2 text-xs text-white/60">
                            <span class="text-neon"></span>
                            <span>Our <strong class="text-white">7 AI agents</strong> will collaborate to analyze your assets and create a personalized commercial gameplan.</span>
                        </div>
                    </div>
                    
                    <!-- Modal Body -->
                    <div class="p-6">
                        <!-- Drop Zone -->
                        <div id="drop-zone" class="relative border-2 border-dashed border-white/10 rounded-xl p-8 text-center transition-all duration-300 hover:border-neon/50 hover:bg-neon/5 cursor-pointer group" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)" onclick="document.getElementById('file-input-hidden').click()">
                            <input type="file" id="file-input-hidden" class="hidden" multiple accept="image/*,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt,.ai,.psd,.svg" onchange="handleFileSelect(event)">
                            
                            <div class="space-y-4">
                                <div class="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-neon/5 to-purple-500/5 border border-white/5 flex items-center justify-center group-hover:scale-110 group-hover:border-neon/30 group-hover:shadow-[0_0_30px_rgba(0,243,255,0.15)] transition-all duration-500">
                                    <svg class="w-10 h-10 text-white/30 group-hover:text-neon transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-white font-medium">Drop files to attach</p>
                                    <p class="text-xs text-white/40 mt-2"><span class="text-neon">Browse</span> or drag & drop</p>
                                </div>
                                <div class="flex flex-wrap justify-center gap-2 mt-4">
                                    <span class="px-2 py-1 text-[10px] font-mono bg-white/5 rounded text-white/40">PNG</span>
                                    <span class="px-2 py-1 text-[10px] font-mono bg-white/5 rounded text-white/40">JPG</span>
                                    <span class="px-2 py-1 text-[10px] font-mono bg-white/5 rounded text-white/40">PDF</span>
                                    <span class="px-2 py-1 text-[10px] font-mono bg-white/5 rounded text-white/40">SVG</span>
                                    <span class="px-2 py-1 text-[10px] font-mono bg-white/5 rounded text-white/40">AI</span>
                                </div>
                            </div>
                            
                            <!-- Drag Overlay -->
                            <div id="drag-overlay" class="absolute inset-0 bg-[#0a0a1e]/90 border-2 border-neon rounded-xl items-center justify-center z-20 backdrop-blur-sm" style="display: none;">
                                <div class="text-center">
                                    <div class="text-4xl mb-2 animate-bounce"></div>
                                    <span class="text-neon font-bold text-lg tracking-widest">RELEASE TO UPLOAD</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- File Counter -->
                        <div class="flex items-center justify-between mt-6 px-1 border-b border-white/5 pb-2">
                            <span id="file-counter" class="text-[10px] font-mono text-white/40 uppercase tracking-wider">0 / 10 FILES ATTACHED</span>
                            <button onclick="clearAllFiles()" id="clear-all-btn" class="text-[10px] font-mono text-red-400/50 hover:text-red-400 transition-colors hidden uppercase tracking-wider">Clear all</button>
                        </div>
                        
                        <!-- File Preview Grid -->
                        <div id="file-preview-grid" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-[240px] overflow-y-auto custom-scrollbar min-h-[100px]">
                            <div id="empty-state" class="col-span-full flex flex-col items-center justify-center py-8 text-white/10">
                                <span class="text-4xl mb-2 grayscale opacity-20"></span>
                                <span class="text-xs">No files yet</span>
                            </div>
                        </div>
                        
                        <!-- Asset Type Detection -->
                        <div id="asset-hints" class="mt-4 hidden">
                            <div class="text-[10px] font-mono text-white/40 uppercase tracking-wider mb-2">Detected Asset Types:</div>
                            <div id="asset-type-badges" class="flex flex-wrap gap-2"></div>
                        </div>
                    </div>
                    
                    <!-- Modal Footer -->
                    <div class="px-6 py-4 border-t border-white/10 bg-black/40 flex justify-between items-center">
                        <div class="text-[10px] text-white/30 font-mono hidden sm:block">
                            <span class="text-neon"></span> Brand Analyst + <span class="text-purple-400"></span> Visual Strategist will process your assets
                        </div>
                        <div class="flex gap-3">
                            <button onclick="closeUploadModal()" class="px-4 py-2 text-xs font-mono text-white/50 hover:text-white transition-colors uppercase tracking-wider">Cancel</button>
                            <button onclick="confirmUpload()" id="confirm-upload-btn" class="px-6 py-2 bg-gradient-to-r from-neon to-purple-600 rounded-lg text-xs font-bold text-black uppercase tracking-widest hover:shadow-[0_0_20px_rgba(0,243,255,0.4)] hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:shadow-none" disabled>
                                Attach Files <span id="attach-count" class="hidden ml-1 opacity-70">(0)</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================================
         FILE UPLOAD STYLES
         ======================================================================== -->
    <style>
        .file-preview-card {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .file-preview-card:hover {
            border-color: #00F3FF;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            transform: translateY(-2px);
        }
        .file-preview-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .file-preview-card:hover img {
            transform: scale(1.1);
        }
        .file-preview-card .file-icon {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .file-preview-card .remove-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease;
            z-index: 10;
        }
        .file-preview-card:hover .remove-btn {
            opacity: 1;
            transform: scale(1);
        }
        .file-preview-card .remove-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
        }
        .file-preview-card .file-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        .file-preview-card:hover .file-info {
            transform: translateY(0);
        }
        .file-preview-card .asset-badge {
            position: absolute;
            top: 6px;
            left: 6px;
            padding: 2px 6px;
            font-size: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 4px;
            backdrop-filter: blur(4px);
        }
        .file-preview-card .asset-badge.logo { background: rgba(168, 85, 247, 0.8); color: white; }
        .file-preview-card .asset-badge.product { background: rgba(0, 206, 209, 0.8); color: black; }
        .file-preview-card .asset-badge.brand { background: rgba(245, 158, 11, 0.8); color: black; }
        .file-preview-card .asset-badge.image { background: rgba(16, 185, 129, 0.8); color: white; }
        
        /* Inline Chat Chips */
        #attached-files-bar {
            display: none;
            padding: 12px;
            background: rgba(0, 206, 209, 0.03);
            border: 1px solid rgba(0, 206, 209, 0.15);
            border-radius: 12px;
            margin-bottom: 12px;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        #attached-files-bar.has-files { display: block; }
        
        .attached-file-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px 4px 4px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        .attached-file-chip:hover {
            background: rgba(0, 243, 255, 0.1);
            border-color: rgba(0, 243, 255, 0.3);
        }
        .attached-file-chip img {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            object-fit: cover;
        }
        .attached-file-chip .icon-box {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .attached-file-chip .remove-chip {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.4);
            cursor: pointer;
            margin-left: 4px;
        }
        .attached-file-chip .remove-chip:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0, 243, 255, 0.2); border-radius: 2px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0, 243, 255, 0.5); }
        
        /* Upload Button Glow */
        #upload-btn.has-files {
            color: #00F3FF !important;
            border-color: rgba(0, 243, 255, 0.5) !important;
            background: rgba(0, 243, 255, 0.1) !important;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }
        
        /* Asset Analysis Animation */
        @keyframes analyzeAsset {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 243, 255, 0.4); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px 5px rgba(0, 243, 255, 0.2); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 243, 255, 0); }
        }
        .file-preview-card.analyzing {
            animation: analyzeAsset 1.5s ease-in-out infinite;
        }
    </style>

    <!-- ========================================================================
         FILE UPLOAD JAVASCRIPT + AGENT PIPELINE INTEGRATION
         ======================================================================== -->
    <script>
        // ==================================================================================
        // FLAWLESS GENESIS - ASSET-AWARE FILE SYSTEM
        // ==================================================================================
        
        window.uploadedFiles = [];
        const MAX_FILES = 10;
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
        
        const FILE_ICONS = { 
            'pdf': '', 'doc': '', 'docx': '', 
            'ppt': '', 'pptx': '', 'xls': '', 'xlsx': '', 
            'txt': '', 'ai': '', 'psd': '', 'svg': '',
            'default': '' 
        };
        
        // Asset type detection patterns
        const ASSET_PATTERNS = {
            logo: /logo|brand.*mark|icon|favicon|emblem|symbol/i,
            product: /product|item|merchandise|goods|hero.*shot|packshot|catalog/i,
            brand: /brand.*guide|style.*guide|guideline|standards|identity|manual/i,
            image: /photo|image|picture|shot|banner|background|lifestyle/i
        };
        
        function detectAssetType(filename) {
            for (const [type, pattern] of Object.entries(ASSET_PATTERNS)) {
                if (pattern.test(filename)) return type;
            }
            // Default based on file type
            const ext = filename.split('.').pop().toLowerCase();
            if (['pdf', 'doc', 'docx', 'ppt', 'pptx'].includes(ext)) return 'brand';
            return 'image';
        }
        
        function openUploadModal() {
            const modal = document.getElementById('file-upload-modal');
            const backdrop = document.getElementById('upload-modal-backdrop');
            const panel = document.getElementById('upload-modal-panel');
            if (!modal) return;
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            backdrop.classList.remove('opacity-0'); backdrop.classList.add('opacity-100');
            panel.classList.remove('opacity-0', 'scale-95'); panel.classList.add('opacity-100', 'scale-100');
            renderFilePreviewGrid();
        }
        
        function closeUploadModal() {
            const modal = document.getElementById('file-upload-modal');
            const backdrop = document.getElementById('upload-modal-backdrop');
            const panel = document.getElementById('upload-modal-panel');
            if (!modal) return;
            backdrop.classList.remove('opacity-100'); backdrop.classList.add('opacity-0');
            panel.classList.remove('opacity-100', 'scale-100'); panel.classList.add('opacity-0', 'scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        function handleFileSelect(e) {
            processFiles(Array.from(e.target.files));
            e.target.value = '';
        }
        
        function handleDrop(e) {
            e.preventDefault(); e.stopPropagation();
            document.getElementById('drop-zone').classList.remove('border-neon', 'bg-neon/10');
            document.getElementById('drag-overlay').style.display = 'none';
            processFiles(Array.from(e.dataTransfer.files));
        }

        function handleDragOver(e) {
            e.preventDefault(); e.stopPropagation();
            document.getElementById('drop-zone').classList.add('border-neon', 'bg-neon/10');
            document.getElementById('drag-overlay').style.display = 'flex';
        }

        function handleDragLeave(e) {
            e.preventDefault(); e.stopPropagation();
            document.getElementById('drop-zone').classList.remove('border-neon', 'bg-neon/10');
            document.getElementById('drag-overlay').style.display = 'none';
        }
        
        function processFiles(files) {
            const remaining = MAX_FILES - window.uploadedFiles.length;
            if (remaining <= 0) {
                showUploadToast('Max 10 files allowed', 'warning');
                return;
            }
            
            let addedCount = 0;
            files.slice(0, remaining).forEach(file => {
                if (file.size > MAX_FILE_SIZE) {
                    showUploadToast(file.name + ' is too large (Max 10MB)', 'error');
                    return;
                }
                
                const isImage = file.type.startsWith('image/');
                const extension = file.name.split('.').pop().toLowerCase();
                const assetType = detectAssetType(file.name);
                
                window.uploadedFiles.push({
                    id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                    file: file,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    isImage: isImage,
                    preview: isImage ? URL.createObjectURL(file) : null,
                    extension: extension,
                    assetType: assetType,
                    lastModified: file.lastModified
                });
                addedCount++;
            });
            
            if (addedCount > 0) {
                showUploadToast(addedCount + ' file(s) added', 'success');
            }
            
            renderFilePreviewGrid();
            updateAttachedFilesBar();
            updateAssetHints();
        }
        
        function showUploadToast(message, type) {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-emerald-500/20 border-emerald-500/30 text-emerald-300' :
                           type === 'error' ? 'bg-red-500/20 border-red-500/30 text-red-300' :
                           'bg-amber-500/20 border-amber-500/30 text-amber-300';
            toast.className = 'fixed bottom-4 right-4 ' + bgColor + ' border px-6 py-3 rounded-xl z-[9999] font-mono text-sm shadow-lg';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }
        
        function renderFilePreviewGrid() {
            const grid = document.getElementById('file-preview-grid');
            const empty = document.getElementById('empty-state');
            
            if (window.uploadedFiles.length === 0) {
                empty.classList.remove('hidden');
                grid.innerHTML = '';
                grid.appendChild(empty);
            } else {
                empty.classList.add('hidden');
                Array.from(grid.children).forEach(c => c.id !== 'empty-state' && c.remove());
                
                window.uploadedFiles.forEach(f => {
                    const div = document.createElement('div');
                    div.className = 'file-preview-card';
                    
                    const assetBadgeClass = 'asset-badge ' + f.assetType;
                    const assetBadgeText = f.assetType.charAt(0).toUpperCase() + f.assetType.slice(1);
                    
                    div.innerHTML = 
                        (f.isImage ? '<img src="' + f.preview + '" alt="' + f.name + '">' : '<div class="file-icon"><span class="text-3xl">' + (FILE_ICONS[f.extension] || FILE_ICONS.default) + '</span></div>') +
                        '<span class="' + assetBadgeClass + '">' + assetBadgeText + '</span>' +
                        '<button class="remove-btn" onclick="removeFile(\'' + f.id + '\')"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg></button>' +
                        '<div class="file-info"><div class="text-[10px] text-white truncate font-mono">' + f.name + '</div></div>';
                    
                    grid.appendChild(div);
                });
            }
            
            const count = window.uploadedFiles.length;
            document.getElementById('file-counter').textContent = count + ' / 10 FILES ATTACHED';
            document.getElementById('attach-count').textContent = '(' + count + ')';
            document.getElementById('attach-count').classList.toggle('hidden', count === 0);
            document.getElementById('clear-all-btn').classList.toggle('hidden', count === 0);
            document.getElementById('confirm-upload-btn').disabled = count === 0;
        }
        
        function updateAssetHints() {
            const hints = document.getElementById('asset-hints');
            const badges = document.getElementById('asset-type-badges');
            
            if (window.uploadedFiles.length === 0) {
                hints.classList.add('hidden');
                return;
            }
            
            hints.classList.remove('hidden');
            
            const typeCounts = {};
            window.uploadedFiles.forEach(f => {
                typeCounts[f.assetType] = (typeCounts[f.assetType] || 0) + 1;
            });
            
            const colors = {
                logo: 'bg-purple-500/20 text-purple-300 border-purple-500/30',
                product: 'bg-neon/20 text-neon border-neon/30',
                brand: 'bg-amber-500/20 text-amber-300 border-amber-500/30',
                image: 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30'
            };
            
            badges.innerHTML = Object.entries(typeCounts).map(function(entry) {
                const type = entry[0];
                const count = entry[1];
                return '<span class="px-2 py-1 text-[10px] font-mono border rounded ' + colors[type] + '">' + count + ' ' + type + (count > 1 ? 's' : '') + '</span>';
            }).join('');
        }
        
        function removeFile(id) {
            const file = window.uploadedFiles.find(f => f.id === id);
            if (file && file.preview) {
                URL.revokeObjectURL(file.preview);
            }
            window.uploadedFiles = window.uploadedFiles.filter(f => f.id !== id);
            renderFilePreviewGrid();
            updateAttachedFilesBar();
            updateAssetHints();
        }
        
        function clearAllFiles() {
            window.uploadedFiles.forEach(f => f.preview && URL.revokeObjectURL(f.preview));
            window.uploadedFiles = [];
            renderFilePreviewGrid();
            updateAttachedFilesBar();
            updateAssetHints();
        }
        
        function confirmUpload() {
            closeUploadModal();
            updateAttachedFilesBar();
            
            if (window.uploadedFiles.length > 0) {
                const logos = window.uploadedFiles.filter(f => f.assetType === 'logo').length;
                const products = window.uploadedFiles.filter(f => f.assetType === 'product').length;
                const brands = window.uploadedFiles.filter(f => f.assetType === 'brand').length;
                
                let summary = window.uploadedFiles.length + ' asset(s) attached';
                const parts = [];
                if (logos > 0) parts.push(logos + ' logo(s)');
                if (products > 0) parts.push(products + ' product shot(s)');
                if (brands > 0) parts.push(brands + ' brand doc(s)');
                if (parts.length > 0) summary += ' - ' + parts.join(', ');
                
                showUploadToast(summary, 'success');
            }
        }
        
        function updateAttachedFilesBar() {
            const bar = document.getElementById('attached-files-bar');
            const btn = document.getElementById('upload-btn');
            
            if (!bar) return;
            
            if (window.uploadedFiles.length > 0) {
                bar.classList.add('has-files');
                if (btn) btn.classList.add('has-files');
                
                bar.innerHTML = 
                    '<div class="flex items-center justify-between mb-2">' +
                        '<span class="text-[10px] font-mono text-neon tracking-widest uppercase"> Brand Assets (' + window.uploadedFiles.length + ') - Ready for Agent Analysis</span>' +
                        '<button onclick="openUploadModal()" class="text-[10px] text-white/50 hover:text-white transition-colors uppercase tracking-wider">+ Manage</button>' +
                    '</div>' +
                    '<div class="flex flex-wrap">' +
                        window.uploadedFiles.map(function(f) {
                            return '<div class="attached-file-chip">' +
                                (f.isImage ? '<img src="' + f.preview + '" alt="' + f.name + '">' : '<div class="icon-box">' + (FILE_ICONS[f.extension] || FILE_ICONS.default) + '</div>') +
                                '<span class="text-[10px] text-white/80 font-mono truncate max-w-[100px]">' + f.name + '</span>' +
                                '<div class="remove-chip" onclick="removeFile(\'' + f.id + '\')"></div>' +
                            '</div>';
                        }).join('') +
                    '</div>';
            } else {
                bar.classList.remove('has-files');
                bar.innerHTML = '';
                if (btn) btn.classList.remove('has-files');
            }
        }

        // ==================================================================================
        // GENESIS PIPELINE INTEGRATION - ALL AGENTS COLLABORATE ON ASSETS
        // ==================================================================================
        (function() {
            // 1. Extend collectedLeadData to include assets
            if (typeof collectedLeadData !== 'undefined') {
                collectedLeadData.uploadedAssets = [];
            }
            
            // 2. Hook into triggerGenesisStrategy to include assets in API payload
            const _originalTrigger = window.triggerGenesisStrategy;
            if (_originalTrigger) {
                window.triggerGenesisStrategy = async function() {
                    console.log(' GENESIS: Preparing assets for collaborative agent analysis...');
                    
                    // Prepare asset metadata for ALL agents
                    if (typeof collectedLeadData !== 'undefined') {
                        collectedLeadData.uploadedAssets = window.uploadedFiles.map(f => ({
                            id: f.id,
                            name: f.name,
                            type: f.type,
                            size: f.size,
                            extension: f.extension,
                            assetType: f.assetType,
                            isImage: f.isImage,
                            lastModified: f.lastModified,
                            // Base64 preview for Brand Analyst vision analysis
                            preview: f.preview
                        }));
                        
                        // Log asset summary for debugging
                        const logos = window.uploadedFiles.filter(f => f.assetType === 'logo');
                        const products = window.uploadedFiles.filter(f => f.assetType === 'product');
                        const brands = window.uploadedFiles.filter(f => f.assetType === 'brand');
                        const images = window.uploadedFiles.filter(f => f.assetType === 'image');
                        
                        console.log(' ASSET SUMMARY FOR AGENT COLLABORATION:');
                        console.log('    Brand Analyst will process:', logos.length, 'logos,', brands.length, 'brand docs');
                        console.log('    Visual Strategist will plan:', products.length, 'product shots,', images.length, 'images');
                        console.log('    Trend Scout +  Market +  Competitor will use brand context');
                        console.log('    Synthesizer will create commercial gameplan');
                    }
                    
                    // Call original trigger with enhanced payload
                    return _originalTrigger.apply(this, arguments);
                };
            }
            
            // 3. Enhance strategy modal with asset analysis results
            const _originalShowModal = window.showStrategyModal;
            if (_originalShowModal) {
                window.showStrategyModal = function(data) {
                    // Add asset analysis section to modal data
                    if (window.uploadedFiles.length > 0 && data) {
                        data.assetsAnalyzed = {
                            total: window.uploadedFiles.length,
                            logos: window.uploadedFiles.filter(f => f.assetType === 'logo').length,
                            products: window.uploadedFiles.filter(f => f.assetType === 'product').length,
                            brandDocs: window.uploadedFiles.filter(f => f.assetType === 'brand').length,
                            images: window.uploadedFiles.filter(f => f.assetType === 'image').length
                        };
                        
                        // Add visual plan context if available
                        if (data.strategy && data.strategy.visual_plan) {
                            data.scenesPlanned = data.strategy.visual_plan.scenes ? data.strategy.visual_plan.scenes.length : 0;
                            data.assetsUsedInScenes = Object.keys(data.strategy.visual_plan.asset_usage_map || {}).length;
                        }
                    }
                    return _originalShowModal.apply(this, arguments);
                };
            }
            
            // 4. Add asset context to SSE progress messages
            const _originalRenderAgent = window.renderAgentProgress;
            if (_originalRenderAgent) {
                window.renderAgentProgress = function(agentName, message, progress) {
                    // Enhance messages with asset context
                    if (window.uploadedFiles.length > 0) {
                        if (agentName.includes('Brand')) {
                            const logos = window.uploadedFiles.filter(f => f.assetType === 'logo').length;
                            if (logos > 0 && message.includes('complete')) {
                                message = message.replace('complete', 'complete - extracted brand DNA from ' + logos + ' logo(s)');
                            }
                        }
                        if (agentName.includes('Visual')) {
                            const assets = window.uploadedFiles.length;
                            if (message.includes('planning')) {
                                message = message + ' using ' + assets + ' uploaded assets';
                            }
                        }
                    }
                    return _originalRenderAgent.apply(this, arguments);
                };
            }
        })();
        
        // Close modal on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('file-upload-modal');
                if (modal && !modal.classList.contains('hidden')) {
                    closeUploadModal();
                }
            }
        });
        
        // Close on backdrop click
        document.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'upload-modal-backdrop') {
                closeUploadModal();
            }
        });
    </script>

</body>

