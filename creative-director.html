<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Creative Director | LEGENDARY Pipeline | Neural Ad Forge | Barrios A2I</title>
    <meta name="description" content="LEGENDARY 6-Agent AI Creative Director. Full pipeline from intake to video delivery. Trinity MCP research, Graph-of-Thoughts ideation, Self-RAG scripts, RAGNAROK v7.0 production.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- LEGENDARY Styles -->
    <link rel="stylesheet" href="css/creative-director.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#0a0a0f',
                        obsidian: '#0a0a1e',
                        neon: '#00F3FF',
                        primary: '#00C2FF',
                        accent: '#F59E0B',
                        glass: 'rgba(255, 255, 255, 0.05)',
                        glassHover: 'rgba(255, 255, 255, 0.1)',
                        'brand-blue': '#00C2FF',
                        'brand-gold': '#ffd700',
                    },
                    fontFamily: {
                        sans: ['Syne', 'sans-serif'],
                        serif: ['Instrument Serif', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
</head>
<body class="antialiased font-sans selection:bg-neon selection:text-white">
    <!-- Canvas Background -->
    <div id="canvas-container"></div>

    <!-- ========== LEGENDARY HEADER ========== -->
    <header id="global-header" class="legendary-header">
        <div class="header-bg" id="header-bg"></div>

        <nav class="header-nav">
            <!-- Brand Section -->
            <a href="/" class="brand-section">
                <div class="brand-logo">
                    <div class="logo-glow"></div>
                    <img src="brand/barrios-a2i-shard-logo.png" alt="Barrios A2I" class="logo-img">
                    <div id="connection-status" class="status-dot"></div>
                </div>
                <div class="brand-text">
                    <span class="brand-system">LEGENDARY_PIPELINE</span>
                    <span class="brand-name">BARRIOS <span class="text-brand-gold">A2I</span></span>
                </div>
            </a>

            <!-- Title & Badge -->
            <div class="header-title">
                <h1>AI Creative Director</h1>
                <span class="legendary-badge">
                    <iconify-icon icon="lucide:crown" width="12"></iconify-icon>
                    LEGENDARY
                </span>
            </div>

            <!-- Session Info -->
            <div class="session-info">
                <span class="session-label">SESSION</span>
                <span id="session-id-display" class="session-id">--</span>
            </div>
        </nav>
    </header>

    <!-- ========== PIPELINE PROGRESS BAR ========== -->
    <div class="pipeline-progress">
        <div class="pipeline-track">
            <div id="progress-bar" class="pipeline-fill"></div>
        </div>
        <div id="phase-indicators" class="phase-indicators">
            <div class="phase-dot active" data-phase="intake">
                <span class="phase-icon"><iconify-icon icon="lucide:message-square" width="14"></iconify-icon></span>
                <span class="phase-label">INTAKE</span>
            </div>
            <div class="phase-dot" data-phase="research">
                <span class="phase-icon"><iconify-icon icon="lucide:search" width="14"></iconify-icon></span>
                <span class="phase-label">RESEARCH</span>
            </div>
            <div class="phase-dot" data-phase="ideation">
                <span class="phase-icon"><iconify-icon icon="lucide:lightbulb" width="14"></iconify-icon></span>
                <span class="phase-label">IDEATION</span>
            </div>
            <div class="phase-dot" data-phase="script">
                <span class="phase-icon"><iconify-icon icon="lucide:file-text" width="14"></iconify-icon></span>
                <span class="phase-label">SCRIPT</span>
            </div>
            <div class="phase-dot" data-phase="review">
                <span class="phase-icon"><iconify-icon icon="lucide:check-circle" width="14"></iconify-icon></span>
                <span class="phase-label">REVIEW</span>
            </div>
            <div class="phase-dot" data-phase="production">
                <span class="phase-icon"><iconify-icon icon="lucide:video" width="14"></iconify-icon></span>
                <span class="phase-label">PRODUCTION</span>
            </div>
            <div class="phase-dot" data-phase="delivery">
                <span class="phase-icon"><iconify-icon icon="lucide:download" width="14"></iconify-icon></span>
                <span class="phase-label">DELIVERY</span>
            </div>
        </div>
    </div>

    <!-- ========== MAIN CONTENT ========== -->
    <main class="main-content">
        <!-- Chat Container -->
        <div class="chat-section">
            <div id="chat-container" class="chat-container">
                <!-- Welcome Screen (shown initially) -->
                <div id="welcome-screen" class="welcome-screen">
                    <div class="welcome-icon">
                        <iconify-icon icon="lucide:sparkles" width="48"></iconify-icon>
                    </div>
                    <h2>Welcome to the LEGENDARY Pipeline</h2>
                    <p>I'm your AI Creative Director powered by a 6-agent system. Tell me about your business and I'll guide you through creating a production-ready commercial.</p>
                    <div class="welcome-features">
                        <div class="feature">
                            <iconify-icon icon="lucide:brain" width="20"></iconify-icon>
                            <span>Trinity MCP Market Research</span>
                        </div>
                        <div class="feature">
                            <iconify-icon icon="lucide:network" width="20"></iconify-icon>
                            <span>Graph-of-Thoughts Ideation</span>
                        </div>
                        <div class="feature">
                            <iconify-icon icon="lucide:file-code" width="20"></iconify-icon>
                            <span>Self-RAG Script Writing</span>
                        </div>
                        <div class="feature">
                            <iconify-icon icon="lucide:video" width="20"></iconify-icon>
                            <span>RAGNAROK v7.0 Production</span>
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div id="chat-messages" class="chat-messages"></div>

                <!-- Typing Indicator Template -->
                <div id="typing-indicator" class="typing-indicator hidden">
                    <div class="typing-avatar">
                        <iconify-icon icon="lucide:bot" width="16"></iconify-icon>
                    </div>
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>

            <!-- Generative UI Container -->
            <div id="generative-ui" class="generative-ui hidden">
                <!-- Concept Cards Container -->
                <div id="concept-cards-container" class="concept-cards-container hidden"></div>

                <!-- Script Preview Container -->
                <div id="script-preview-container" class="script-preview-container hidden"></div>

                <!-- Production Progress Container -->
                <div id="production-progress-container" class="production-progress-container hidden"></div>
            </div>

            <!-- Error Container -->
            <div id="error-container" class="error-container hidden">
                <iconify-icon icon="lucide:alert-circle" width="16"></iconify-icon>
                <span id="error-message"></span>
                <button onclick="retryLastMessage()">Retry</button>
            </div>

            <!-- Quick Actions -->
            <div id="quick-actions" class="quick-actions hidden"></div>

            <!-- Input Area -->
            <div class="input-area">
                <form id="chat-input-form" class="chat-input-form">
                    <input
                        type="text"
                        id="chat-input"
                        placeholder="Describe your business or answer the question..."
                        autocomplete="off"
                    >
                    <button type="submit" id="send-btn" class="send-btn">
                        <iconify-icon icon="lucide:send" width="18"></iconify-icon>
                    </button>
                </form>
                <div class="input-hints">
                    <span>Press Enter to send</span>
                    <span class="divider">|</span>
                    <span id="phase-hint">Phase 1: Business Information</span>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
            <!-- Brief Summary -->
            <div class="sidebar-section brief-summary">
                <div class="section-header">
                    <iconify-icon icon="lucide:file-text" width="16"></iconify-icon>
                    <span>Brief Summary</span>
                </div>
                <div id="brief-content" class="section-content">
                    <p class="placeholder">Complete the intake to see your brief summary...</p>
                </div>
            </div>

            <!-- Research Insights -->
            <div class="sidebar-section research-insights hidden" id="research-section">
                <div class="section-header">
                    <iconify-icon icon="lucide:search" width="16"></iconify-icon>
                    <span>Research Insights</span>
                    <span class="badge">Trinity MCP</span>
                </div>
                <div id="research-content" class="section-content">
                    <p class="placeholder">Market research results will appear here...</p>
                </div>
            </div>

            <!-- Quality Score -->
            <div class="sidebar-section quality-score hidden" id="quality-section">
                <div class="section-header">
                    <iconify-icon icon="lucide:gauge" width="16"></iconify-icon>
                    <span>Quality Score</span>
                    <span class="badge">PRM</span>
                </div>
                <div id="quality-content" class="section-content">
                    <div class="score-display">
                        <span id="quality-score-value" class="score-value">--</span>
                        <span class="score-label">/ 100</span>
                    </div>
                    <div id="quality-breakdown" class="quality-breakdown"></div>
                </div>
            </div>

            <!-- Actions -->
            <div class="sidebar-actions">
                <button id="download-brief-btn" class="action-btn secondary" onclick="downloadBrief()" disabled>
                    <iconify-icon icon="lucide:download" width="16"></iconify-icon>
                    Download Brief
                </button>
                <button id="run-pipeline-btn" class="action-btn primary" onclick="runFullPipeline()" disabled>
                    <iconify-icon icon="lucide:play" width="16"></iconify-icon>
                    Run Full Pipeline
                </button>
            </div>
        </aside>
    </main>

    <!-- ========== PAYMENT MODAL ========== -->
    <div id="payment-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closePaymentModal()"></div>
        <div class="modal-content payment-modal">
            <button class="modal-close" onclick="closePaymentModal()">
                <iconify-icon icon="lucide:x" width="20"></iconify-icon>
            </button>

            <div class="modal-header">
                <iconify-icon icon="lucide:sparkles" width="32" class="text-neon"></iconify-icon>
                <h2>Your AI Commercial Awaits</h2>
                <p>Choose your package to begin production</p>
            </div>

            <div class="pricing-options">
                <!-- Standard Package -->
                <div class="pricing-card standard" onclick="startCheckout('standard')">
                    <div class="card-header">
                        <div class="card-icon">
                            <iconify-icon icon="lucide:zap" width="24"></iconify-icon>
                        </div>
                        <div class="card-title">
                            <h3>Standard Package</h3>
                            <p>30-second AI commercial</p>
                        </div>
                        <div class="card-price">
                            <span class="price">$499</span>
                            <span class="term">one-time</span>
                        </div>
                    </div>
                    <ul class="card-features">
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> AI-generated video from your brief</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> 1 revision included</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Delivered in 48-72 hours</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Full commercial rights</li>
                    </ul>
                    <button class="card-btn">
                        <iconify-icon icon="lucide:credit-card" width="16"></iconify-icon>
                        Purchase Now
                    </button>
                </div>

                <!-- Premium Package -->
                <div class="pricing-card premium" onclick="startCheckout('premium')">
                    <div class="popular-badge">MOST POPULAR</div>
                    <div class="card-header">
                        <div class="card-icon">
                            <iconify-icon icon="lucide:crown" width="24"></iconify-icon>
                        </div>
                        <div class="card-title">
                            <h3>Premium Package</h3>
                            <p>Full campaign production</p>
                        </div>
                        <div class="card-price">
                            <span class="price">Custom</span>
                            <span class="term">from $2,500</span>
                        </div>
                    </div>
                    <ul class="card-features">
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Multiple video lengths & formats</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Unlimited revisions</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Dedicated creative director</li>
                        <li><iconify-icon icon="lucide:check" width="14"></iconify-icon> Priority 24-hour delivery</li>
                    </ul>
                    <button class="card-btn">
                        <iconify-icon icon="lucide:calendar" width="16"></iconify-icon>
                        Book Consultation
                    </button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="download-link" onclick="downloadBrief()">
                    <iconify-icon icon="lucide:download" width="14"></iconify-icon>
                    Download Brief as PDF
                </button>
            </div>
        </div>
    </div>

    <!-- ========== VIDEO DELIVERY MODAL ========== -->
    <div id="delivery-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content delivery-modal">
            <div class="modal-header success">
                <iconify-icon icon="lucide:check-circle" width="48" class="text-green-400"></iconify-icon>
                <h2>Your Video is Ready!</h2>
                <p>Your AI-generated commercial has been produced by RAGNAROK v7.0</p>
            </div>

            <div class="video-preview">
                <video id="delivery-video" controls></video>
            </div>

            <div class="delivery-stats">
                <div class="stat">
                    <span class="stat-label">Render Time</span>
                    <span id="render-time" class="stat-value">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Quality Score</span>
                    <span id="final-quality-score" class="stat-value">--</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Format</span>
                    <span id="video-format" class="stat-value">MP4 1080p</span>
                </div>
            </div>

            <div class="delivery-actions">
                <button class="action-btn primary" onclick="downloadVideo()">
                    <iconify-icon icon="lucide:download" width="16"></iconify-icon>
                    Download Video
                </button>
                <button class="action-btn secondary" onclick="shareVideo()">
                    <iconify-icon icon="lucide:share-2" width="16"></iconify-icon>
                    Share
                </button>
            </div>
        </div>
    </div>

    <!-- ========== TEMPLATES ========== -->

    <!-- Concept Card Template -->
    <template id="concept-card-template">
        <div class="concept-card" data-concept-id="">
            <div class="card-visual">
                <div class="visual-placeholder">
                    <iconify-icon icon="lucide:image" width="32"></iconify-icon>
                </div>
            </div>
            <div class="card-content">
                <h3 class="concept-title"></h3>
                <p class="concept-hook"></p>
                <div class="concept-meta">
                    <span class="meta-item">
                        <iconify-icon icon="lucide:clock" width="12"></iconify-icon>
                        <span class="concept-duration"></span>
                    </span>
                    <span class="meta-item">
                        <iconify-icon icon="lucide:palette" width="12"></iconify-icon>
                        <span class="concept-style"></span>
                    </span>
                </div>
                <div class="concept-score">
                    <div class="score-bar">
                        <div class="score-fill"></div>
                    </div>
                    <span class="score-label"></span>
                </div>
            </div>
            <button class="select-concept-btn">
                <iconify-icon icon="lucide:check" width="16"></iconify-icon>
                Select This Concept
            </button>
        </div>
    </template>

    <!-- Script Scene Template -->
    <template id="scene-template">
        <div class="scene-card" data-scene-id="">
            <div class="scene-header">
                <span class="scene-number"></span>
                <span class="scene-duration"></span>
            </div>
            <div class="scene-content">
                <div class="scene-visual">
                    <iconify-icon icon="lucide:film" width="24"></iconify-icon>
                </div>
                <div class="scene-details">
                    <p class="scene-action"></p>
                    <p class="scene-voiceover"></p>
                </div>
            </div>
            <div class="scene-notes"></div>
        </div>
    </template>

    <!-- Production Step Template -->
    <template id="production-step-template">
        <div class="production-step" data-step="">
            <div class="step-icon">
                <iconify-icon icon="" width="20"></iconify-icon>
            </div>
            <div class="step-content">
                <span class="step-name"></span>
                <span class="step-status"></span>
            </div>
            <div class="step-progress">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
            </div>
        </div>
    </template>

    <!-- Three.js Background -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/ScrollTrigger.min.js"></script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ReinhardToneMapping;
        container.appendChild(renderer.domElement);

        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0;
        bloomPass.strength = 1.5;
        bloomPass.radius = 0.5;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // Particle system
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 1500;
        const posArray = new Float32Array(particlesCount * 3);
        for(let i = 0; i < particlesCount * 3; i++) { posArray[i] = (Math.random() - 0.5) * 25; }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.03, color: 0x00F3FF, transparent: true, opacity: 0.6 });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Ambient light
        const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
        scene.add(ambientLight);

        // Spotlight
        const spotlight = new THREE.SpotLight(0x00F3FF, 30);
        spotlight.position.set(5, 5, 5);
        spotlight.angle = 0.3;
        spotlight.penumbra = 0.5;
        scene.add(spotlight);

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.0005;
            particlesMesh.rotation.y = time * 0.1;
            particlesMesh.rotation.x = Math.sin(time) * 0.05;

            const positions = particlesGeometry.attributes.position.array;
            for(let i = 0; i < particlesCount; i++) {
                const i3 = i * 3;
                positions[i3 + 1] += Math.sin(time + positions[i3]) * 0.001;
            }
            particlesGeometry.attributes.position.needsUpdate = true;

            composer.render();
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

    <!-- LEGENDARY Creative Director Logic -->
    <script src="js/creative-director.js"></script>

    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
