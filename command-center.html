<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS // Command Center</title>

    <!-- Font: JetBrains Mono + Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        obsidian: '#020408',
                        panel: '#0a0e1a',
                        cyan: '#00CED1',
                        gold: '#FFD700',
                        amber: '#F59E0B',
                        red: '#EF4444',
                        emerald: '#10B981',
                        border: 'rgba(255, 255, 255, 0.08)',
                    },
                }
            }
        }
    </script>

    <style>
        :root { color-scheme: dark; }
        body {
            background: #020408;
            color: #e2e8f0;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0,194,255,0.3); }

        /* Glass panels */
        .glass-panel {
            background: rgba(10, 14, 26, 0.85);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.2s ease;
        }
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Glow effects */
        .glow-cyan { box-shadow: 0 0 20px rgba(0, 206, 209, 0.15); }
        .glow-gold { box-shadow: 0 0 20px rgba(255, 215, 0, 0.1); }
        .glow-emerald { box-shadow: 0 0 12px rgba(16, 185, 129, 0.2); }

        /* Status pill */
        .status-on {
            color: #00CED1;
            border-color: rgba(0, 206, 209, 0.4);
            box-shadow: 0 0 8px rgba(0, 206, 209, 0.3);
        }
        .status-optional {
            color: rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Animations */
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-slow { animation: pulse-slow 2s ease-in-out infinite; }

        /* CTA Button */
        .cta-primary {
            background: linear-gradient(135deg, #00CED1 0%, #0099CC 100%);
            box-shadow: 0 4px 20px rgba(0, 206, 209, 0.3), inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.2s ease;
        }
        .cta-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 28px rgba(0, 206, 209, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        .cta-primary:active {
            transform: translateY(0);
        }

        /* Sidebar responsive */
        .sidebar { width: 340px; }
        @media (max-width: 1024px) { .sidebar { width: 300px; } }
        @media (max-width: 768px) { .sidebar { width: 280px; } }

        /* Health ring */
        .health-ring {
            background: conic-gradient(
                #00CED1 0deg,
                #00CED1 calc(var(--health) * 3.6deg),
                rgba(255,255,255,0.1) calc(var(--health) * 3.6deg),
                rgba(255,255,255,0.1) 360deg
            );
        }

        /* Tour overlay */
        .tour-overlay {
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }
        .tour-spotlight {
            border: 1px solid rgba(0, 206, 209, 0.5);
            box-shadow: 0 0 0 1px rgba(0, 206, 209, 0.2),
                        0 0 30px rgba(0, 206, 209, 0.25),
                        0 0 0 9999px rgba(0, 0, 0, 0.6);
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col font-sans selection:bg-cyan/20 selection:text-cyan">

    <!-- HEADER - Unified Barrios A2I Component -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-[#0a0a1e]/90 backdrop-blur-md border-b border-[#00bfff]/10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 md:h-20">

      <!-- Logo Section -->
      <a href="/" class="flex items-center gap-3 group">
        <!-- Butterfly Logo -->
        <div class="relative h-10 w-10 md:h-12 md:w-12">
          <img src="/images/barrios-logo.png" alt="Barrios A2I" class="h-full w-full object-contain" />
        </div>

        <!-- Brand Text -->
        <div class="flex flex-col leading-tight">
          <span class="text-[10px] md:text-xs text-[#00ff88] font-mono tracking-[0.2em] uppercase">
            SYSTEM_CONNECTED
          </span>
          <span class="text-lg md:text-xl font-bold tracking-tight">
            <span class="text-white">BARRIOS</span>
            <span class="text-[#00bfff] ml-1">A2I</span>
          </span>
        </div>

        <!-- Status Indicator Dot -->
        <span class="w-2 h-2 rounded-full bg-[#ffd700] shadow-[0_0_8px_#ffd700] ml-2"></span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center">
        <a href="/pricing" class="px-3 lg:px-4 py-2 text-[#8892b0] hover:text-white transition-colors font-mono text-sm tracking-wide">
          [ PRICING ]
        </a>

        <a href="/nexus-personal" class="px-3 lg:px-4 py-2 transition-colors font-mono text-sm tracking-wide group">
          <span class="text-[#8892b0] group-hover:text-[#00bfff]">[</span>
          <span class="text-[#00bfff] mx-1">NEXUS</span>
          <span class="text-[#00bfff]">●</span>
          <span class="text-[#8892b0] group-hover:text-[#00bfff]">]</span>
        </a>

        <a href="/creative-director" class="px-3 lg:px-4 py-2 text-[#8892b0] hover:text-white transition-colors font-mono text-sm tracking-wide">
          [ COMMERCIAL_LAB ]
        </a>

        <a href="/founder" class="px-3 lg:px-4 py-2 text-[#8892b0] hover:text-white transition-colors font-mono text-sm tracking-wide">
          [ FOUNDER ]
        </a>

        <a href="/command-center" class="px-3 lg:px-4 py-2 transition-colors font-mono text-sm tracking-wide group">
          <span class="text-[#8892b0] group-hover:text-[#ffd700]">[</span>
          <span class="text-[#ffd700] mx-1">COMMAND</span>
          <span class="text-[#ffd700]">●</span>
          <span class="text-[#8892b0] group-hover:text-[#ffd700]">]</span>
        </a>
      </nav>

      <!-- Mobile Menu Button -->
      <button
        onclick="document.getElementById('mobile-nav').classList.toggle('hidden')"
        class="md:hidden p-2 text-[#8892b0] hover:text-white transition-colors"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div id="mobile-nav" class="hidden md:hidden bg-[#0a0a1e]/98 border-t border-[#00bfff]/10 backdrop-blur-md">
    <nav class="px-4 py-4 space-y-1">
      <a href="/pricing" class="block py-3 px-4 text-[#8892b0] hover:text-white hover:bg-[#00bfff]/10 rounded font-mono text-sm transition-colors">
        [ PRICING ]
      </a>
      <a href="/nexus-personal" class="block py-3 px-4 text-[#00bfff] hover:bg-[#00bfff]/10 rounded font-mono text-sm transition-colors">
        [ NEXUS ● ]
      </a>
      <a href="/creative-director" class="block py-3 px-4 text-[#8892b0] hover:text-white hover:bg-[#00bfff]/10 rounded font-mono text-sm transition-colors">
        [ COMMERCIAL_LAB ]
      </a>
      <a href="/founder" class="block py-3 px-4 text-[#8892b0] hover:text-white hover:bg-[#00bfff]/10 rounded font-mono text-sm transition-colors">
        [ FOUNDER ]
      </a>
      <a href="/command-center" class="block py-3 px-4 text-[#ffd700] hover:bg-[#ffd700]/10 rounded font-mono text-sm transition-colors">
        [ COMMAND ● ]
      </a>
    </nav>
  </div>
</header>

<!-- Spacer to prevent content from going under fixed header -->
<div class="h-16 md:h-20"></div>

    <main class="flex-1 flex overflow-hidden bg-obsidian relative min-h-0">

        <!-- Background: Command Dashboard -->
        <div class="absolute inset-0 z-0 overflow-hidden opacity-20 pointer-events-none">
            <img src="assets/backgrounds/command-dashboard.png" alt="" class="absolute w-full h-full object-cover object-center">
        </div>

        <!-- LEFT SIDEBAR: Buyer-Focused Control Panel -->
        <aside class="sidebar flex flex-col border-r border-border bg-panel z-30 relative shrink-0 overflow-y-auto" data-nexus-tour="sidebar">

            <!-- Section 1: What Nexus Is -->
            <div class="p-4 border-b border-border" data-nexus-tour="header">
                <h2 class="text-sm font-bold text-white mb-1">Your Private Assistant</h2>
                <p class="text-[11px] text-white/50 leading-relaxed">
                    Installed locally on this computer.<br>
                    <span class="text-white/70 italic">Your files never leave your device.</span>
                </p>
            </div>

            <!-- Section 2: What Nexus Does -->
            <div class="p-4 border-b border-border" data-nexus-tour="capabilities">
                <h3 class="text-[10px] font-bold text-white/60 uppercase tracking-[0.15em] mb-3">What Nexus Does</h3>

                <div class="space-y-2" id="capabilities-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 3: Privacy & Safety -->
            <div class="p-4 border-b border-border" data-nexus-tour="integrity">
                <div class="glass-card rounded-xl p-3 glow-gold bg-gradient-to-br from-gold/5 to-transparent border-gold/20">
                    <h3 class="text-[10px] font-bold text-gold uppercase tracking-[0.15em] mb-2 flex items-center gap-1.5">
                        <i data-lucide="shield-check" class="w-3 h-3"></i>
                        Privacy & Safety
                    </h3>
                    <ul class="space-y-1.5" id="privacy-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Section 4: Proof This Month -->
            <div class="p-4 border-b border-border" data-nexus-tour="proof">
                <div class="flex items-start justify-between mb-3">
                    <h3 class="text-[10px] font-bold text-white/60 uppercase tracking-[0.15em]">Proof This Month</h3>
                    <div class="text-right">
                        <div class="relative w-12 h-12">
                            <div class="absolute inset-0 rounded-full health-ring" style="--health: 92"></div>
                            <div class="absolute inset-1 rounded-full bg-panel flex items-center justify-center">
                                <span class="text-sm font-bold text-cyan" id="health-score">92</span>
                            </div>
                        </div>
                        <div class="text-[8px] text-white/40 mt-0.5">Health</div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2" id="proof-metrics">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 5: Activity Feed (Human-Readable) -->
            <div class="flex-1 p-4 min-h-0 overflow-hidden flex flex-col">
                <div class="flex items-center justify-between mb-2 shrink-0">
                    <h3 class="text-[10px] font-bold text-white/60 uppercase tracking-[0.15em]">Activity</h3>
                    <button
                        class="text-[9px] text-white/40 hover:text-cyan transition flex items-center gap-1"
                        onclick="toggleTechnical()"
                        id="tech-toggle"
                    >
                        <i data-lucide="terminal" class="w-3 h-3"></i>
                        <span id="tech-toggle-text">Show logs</span>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto space-y-1.5 pr-1" id="activity-feed">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Section 6: CTA Buttons -->
            <div class="p-4 border-t border-border shrink-0 space-y-2" data-nexus-tour="cta">
                <button class="cta-primary w-full flex items-center justify-center gap-2 py-3 text-panel font-bold rounded-lg text-sm">
                    <i data-lucide="play" class="w-4 h-4"></i>
                    Run a Demo Task
                </button>
                <button class="w-full py-2.5 bg-white/5 border border-white/10 text-white/80 text-sm font-medium rounded-lg hover:bg-white/10 transition flex items-center justify-center gap-2">
                    Book Full Install
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            </div>
        </aside>

        <!-- RIGHT: ORBITAL ENGINE (Canvas) -->
        <section class="flex-1 relative bg-black min-w-0">

            <!-- Canvas Container -->
            <div id="canvas-container" class="absolute inset-0 z-10"></div>

            <!-- HUD: Target Lock (Top Left) -->
            <div class="absolute top-4 left-4 z-20 pointer-events-none">
                <div class="glass-panel rounded-xl px-4 py-3 min-w-[160px]">
                    <div class="flex items-center gap-1.5 text-gold mb-1">
                        <i data-lucide="target" class="w-3 h-3"></i>
                        <span class="text-[9px] tracking-widest font-bold">TARGET</span>
                    </div>
                    <span class="text-sm font-semibold text-white">SOLAR_BARYCENTER</span>
                    <div class="h-px w-full bg-white/10 my-2"></div>
                    <div class="space-y-0.5 text-[10px]">
                        <div class="flex justify-between text-white/50">
                            <span>CLASS</span>
                            <span class="text-white/80">G-TYPE</span>
                        </div>
                        <div class="flex justify-between text-white/50">
                            <span>BODIES</span>
                            <span class="text-white/80">8</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HUD: Confidence Badge (Top Right) -->
            <div class="absolute top-4 right-4 z-20 pointer-events-none">
                <div class="glass-panel rounded-xl px-3 py-2 min-w-[110px]">
                    <div class="flex items-center gap-1.5 text-cyan mb-2">
                        <i data-lucide="activity" class="w-3 h-3"></i>
                        <span class="text-[9px] tracking-widest font-bold">SYSTEM</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="glass-card rounded-lg px-2 py-1.5">
                            <div class="flex items-center gap-1">
                                <i data-lucide="shield-check" class="w-3 h-3 text-emerald/70"></i>
                                <span class="text-[9px] text-white/70">Private</span>
                            </div>
                            <div class="text-[10px] text-emerald font-semibold">ON</div>
                        </div>
                        <div class="glass-card rounded-lg px-2 py-1.5">
                            <div class="flex items-center gap-1">
                                <i data-lucide="zap" class="w-3 h-3 text-amber/70"></i>
                                <span class="text-[9px] text-white/70">Speed</span>
                            </div>
                            <div class="text-[10px] text-amber font-semibold" id="speed-display">Fast</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HUD: Camera Coords (Bottom Right) -->
            <div class="absolute bottom-4 right-4 z-20 pointer-events-none text-right">
                <span class="text-[9px] text-white/40 tracking-widest">CAM</span>
                <div class="text-[10px] text-cyan font-mono" id="coords">X:0 Y:160 Z:220</div>
            </div>

            <!-- HUD: Corner Brackets -->
            <div class="absolute inset-4 z-10 pointer-events-none">
                <div class="absolute top-0 left-0 w-6 h-6 border-t-2 border-l-2 border-cyan/20"></div>
                <div class="absolute top-0 right-0 w-6 h-6 border-t-2 border-r-2 border-cyan/20"></div>
                <div class="absolute bottom-0 left-0 w-6 h-6 border-b-2 border-l-2 border-cyan/20"></div>
                <div class="absolute bottom-0 right-0 w-6 h-6 border-b-2 border-r-2 border-cyan/20"></div>
            </div>

            <!-- Center crosshair -->
            <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none opacity-15">
                <div class="w-6 h-px bg-cyan"></div>
                <div class="absolute w-px h-6 bg-cyan"></div>
            </div>

            <!-- Controls Floating (Bottom Left) -->
            <div class="absolute bottom-4 left-4 z-20">
                <div class="glass-panel rounded-xl px-3 py-2">
                    <div class="flex items-center gap-3">
                        <div class="flex flex-col">
                            <span class="text-[9px] text-white/40 mb-1">Speed</span>
                            <input type="range" min="0.2" max="3" step="0.1" value="1" id="speed-slider" class="w-20 h-1 bg-white/10 rounded appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:bg-cyan [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:shadow-[0_0_8px_rgba(0,194,255,0.5)]">
                        </div>
                        <span class="text-[10px] text-cyan font-mono w-8" id="speed-val">1.0x</span>
                        <button onclick="resetCam()" class="p-1.5 rounded bg-white/5 hover:bg-white/10 transition" title="Reset Camera">
                            <i data-lucide="crosshair" class="w-3.5 h-3.5 text-white/60"></i>
                        </button>
                        <button onclick="toggleGrid()" class="p-1.5 rounded bg-white/5 hover:bg-white/10 transition" title="Toggle Grid">
                            <i data-lucide="grid-3x3" class="w-3.5 h-3.5 text-white/60"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- GUIDED TOUR OVERLAY (First-time users) -->
    <div id="tour-overlay" class="fixed inset-0 z-[100] hidden">
        <div class="tour-overlay absolute inset-0"></div>
        <div id="tour-spotlight" class="absolute rounded-xl tour-spotlight transition-all duration-300"></div>
        <div id="tour-tooltip" class="absolute glass-panel rounded-2xl p-4 w-[320px] z-[101] transition-all duration-300">
            <div class="flex items-start justify-between mb-2">
                <div>
                    <div class="text-[10px] text-white/50 uppercase tracking-widest mb-1">
                        Nexus Tour • Step <span id="tour-step-num">1</span>/4
                    </div>
                    <h4 class="text-base font-bold text-white" id="tour-title">Welcome</h4>
                </div>
                <button onclick="closeTour()" class="p-1.5 rounded-lg bg-white/5 hover:bg-white/10 transition">
                    <i data-lucide="x" class="w-4 h-4 text-white/60"></i>
                </button>
            </div>
            <p class="text-sm text-white/70 leading-relaxed mb-4" id="tour-body">Welcome to Nexus.</p>
            <div class="flex items-center justify-between">
                <button onclick="prevTourStep()" id="tour-prev" class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/5 text-white/70 text-sm hover:bg-white/10 transition">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i> Back
                </button>
                <button onclick="nextTourStep()" id="tour-next" class="flex items-center gap-1 px-3 py-1.5 rounded-lg bg-cyan text-panel font-semibold text-sm hover:opacity-90 transition">
                    Next <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="mt-3 text-[10px] text-white/40">
                Press <span class="font-mono text-white/60">→</span> to continue, <span class="font-mono text-white/60">Esc</span> to close
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // ========== SIDEBAR DATA ==========

        const capabilities = [
            { icon: 'search', label: 'Find documents fast', status: 'ON' },
            { icon: 'file-text', label: 'Summarize PDFs', status: 'ON' },
            { icon: 'mail', label: 'Draft emails', status: 'ON' },
            { icon: 'bell', label: 'Create reminders', status: 'ON' },
            { icon: 'folder', label: 'Organize files', status: 'ON' },
            { icon: 'calendar', label: 'Calendar sync', status: 'CONNECT' },
            { icon: 'zap', label: 'Workflow automation', status: 'OPTIONAL' },
        ];

        const privacyItems = [
            'Local-only processing',
            'Zero cloud training',
            'Hardware accelerated',
        ];

        const proofMetrics = [
            { icon: 'zap', label: 'Tasks Run', value: '128' },
            { icon: 'clock', label: 'Time Saved', value: '4.3h' },
            { icon: 'shield-check', label: 'Protected', value: '17' },
            { icon: 'trending-up', label: 'Efficiency', value: '+23%' },
        ];

        // Render capabilities
        const capList = document.getElementById('capabilities-list');
        capabilities.forEach(cap => {
            const statusClass = cap.status === 'ON' ? 'status-on' : 'status-optional';
            capList.innerHTML += `
                <div class="glass-card rounded-lg p-2.5 flex items-center justify-between">
                    <div class="flex items-center gap-2.5">
                        <i data-lucide="${cap.icon}" class="w-4 h-4 ${cap.status === 'ON' ? 'text-cyan' : 'text-white/30'}"></i>
                        <span class="text-[12px] text-white/80">${cap.label}</span>
                    </div>
                    <span class="text-[9px] font-bold px-1.5 py-0.5 rounded border ${statusClass}">${cap.status}</span>
                </div>
            `;
        });

        // Render privacy items
        const privList = document.getElementById('privacy-list');
        privacyItems.forEach(item => {
            privList.innerHTML += `
                <li class="flex items-center gap-2 text-[11px] text-white/70">
                    <i data-lucide="check" class="w-3 h-3 text-cyan"></i>
                    ${item}
                </li>
            `;
        });

        // Render proof metrics
        const proofGrid = document.getElementById('proof-metrics');
        proofMetrics.forEach(m => {
            proofGrid.innerHTML += `
                <div class="glass-card rounded-lg p-2">
                    <div class="flex items-center gap-1.5 mb-0.5">
                        <i data-lucide="${m.icon}" class="w-3 h-3 text-gold/70"></i>
                        <span class="text-[9px] text-white/50 uppercase tracking-wide">${m.label}</span>
                    </div>
                    <div class="text-sm font-bold text-white">${m.value}</div>
                </div>
            `;
        });

        // Re-init icons after dynamic content
        lucide.createIcons();

        // ========== ACTIVITY FEED ==========

        const activityTypes = [
            { kind: 'find', icon: 'search', color: 'text-cyan', texts: ['Found "Tax_2023.pdf" in 2.1s', 'Located "Contract_v3.docx"', 'Found 12 matching files'] },
            { kind: 'summary', icon: 'file-text', color: 'text-amber', texts: ['Summarized "Lease.pdf" (28 pages)', 'Summarized "Report_Q4.pdf"', 'Created summary for 3 docs'] },
            { kind: 'protect', icon: 'shield-check', color: 'text-emerald', texts: ['Protected sensitive text', 'Masked password detected', 'Secured personal info'] },
            { kind: 'system', icon: 'sparkles', color: 'text-white/60', texts: ['System sync complete', 'Index updated', 'Cache optimized'] },
        ];

        let showTechnical = false;
        const activityFeed = document.getElementById('activity-feed');

        function addActivity() {
            const type = activityTypes[Math.floor(Math.random() * activityTypes.length)];
            const text = type.texts[Math.floor(Math.random() * type.texts.length)];
            const time = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });

            const div = document.createElement('div');
            div.className = 'glass-card rounded-lg p-2.5';
            div.innerHTML = `
                <div class="flex items-start justify-between gap-2">
                    <div class="flex items-start gap-2 min-w-0">
                        <div class="w-7 h-7 rounded-md bg-white/5 flex items-center justify-center shrink-0">
                            <i data-lucide="${type.icon}" class="w-3.5 h-3.5 ${type.color}"></i>
                        </div>
                        <div class="min-w-0">
                            <div class="text-[11px] text-white/80 font-medium truncate">${text}</div>
                            <div class="text-[9px] text-white/40">${type.kind.charAt(0).toUpperCase() + type.kind.slice(1)}</div>
                        </div>
                    </div>
                    <span class="text-[9px] text-white/30 font-mono shrink-0">${time}</span>
                </div>
                ${showTechnical ? `<div class="mt-2 px-2 py-1.5 rounded bg-obsidian/50 text-[9px] text-white/40 font-mono">LOG: ${type.kind}_v2 → OK → ${Math.floor(Math.random()*1000)}ms</div>` : ''}
            `;

            activityFeed.prepend(div);
            lucide.createIcons();

            // Keep max 15 items
            while (activityFeed.children.length > 15) {
                activityFeed.removeChild(activityFeed.lastChild);
            }
        }

        function toggleTechnical() {
            showTechnical = !showTechnical;
            document.getElementById('tech-toggle-text').innerText = showTechnical ? 'Hide logs' : 'Show logs';
        }

        // Initial activities
        for (let i = 0; i < 5; i++) addActivity();
        setInterval(addActivity, 4000);

        // ========== THREE.JS ORBITAL SYSTEM ==========

        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020408, 0.0008);

        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 2000);
        camera.position.set(0, 160, 220);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        container.appendChild(renderer.domElement);

        // Starfield
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2500;
        const starPos = new Float32Array(starCount * 3);
        for (let i = 0; i < starCount * 3; i++) {
            starPos[i] = (Math.random() - 0.5) * 1400;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.7, transparent: true, opacity: 0.8 }));
        scene.add(stars);

        // Grid
        const gridHelper = new THREE.PolarGridHelper(150, 16, 8, 64, 0x1e3a5f, 0x1e3a5f);
        gridHelper.material.transparent = true;
        gridHelper.material.opacity = 0.1;
        scene.add(gridHelper);

        // Sun
        const sun = new THREE.Mesh(
            new THREE.SphereGeometry(10, 32, 32),
            new THREE.MeshBasicMaterial({ color: 0xFFD700 })
        );

        // Sun glow
        const glowCanvas = document.createElement('canvas');
        glowCanvas.width = 256; glowCanvas.height = 256;
        const ctx = glowCanvas.getContext('2d');
        const grad = ctx.createRadialGradient(128, 128, 0, 128, 128, 128);
        grad.addColorStop(0, 'rgba(255, 220, 100, 1)');
        grad.addColorStop(0.15, 'rgba(255, 180, 50, 0.8)');
        grad.addColorStop(0.4, 'rgba(255, 120, 0, 0.3)');
        grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, 256, 256);

        const sunGlow = new THREE.Sprite(new THREE.SpriteMaterial({
            map: new THREE.CanvasTexture(glowCanvas),
            transparent: true,
            blending: THREE.AdditiveBlending
        }));
        sunGlow.scale.set(80, 80, 1);
        sun.add(sunGlow);
        sun.add(new THREE.PointLight(0xFFFFFF, 2, 500));
        scene.add(sun);
        scene.add(new THREE.AmbientLight(0x404060, 0.5));

        // All 8 Planets
        const planets = [];
        const planetData = [
            { r: 18, size: 1.2, speed: 0.028, color: 0xA0A0A0, name: 'Mercury' },
            { r: 28, size: 2.0, speed: 0.022, color: 0xE6C87A, name: 'Venus' },
            { r: 40, size: 2.2, speed: 0.016, color: 0x00C2FF, name: 'Earth' },
            { r: 54, size: 1.6, speed: 0.012, color: 0xEF4444, name: 'Mars' },
            { r: 75, size: 5.0, speed: 0.007, color: 0xE8C4A0, name: 'Jupiter' },
            { r: 95, size: 4.2, speed: 0.005, color: 0xF4D03F, ring: true, name: 'Saturn' },
            { r: 115, size: 2.8, speed: 0.003, color: 0x7DD3E8, ring: true, ringThin: true, name: 'Uranus' },
            { r: 135, size: 2.6, speed: 0.002, color: 0x4169E1, name: 'Neptune' },
        ];

        planetData.forEach(d => {
            // Orbit
            const curve = new THREE.EllipseCurve(0, 0, d.r, d.r, 0, 2 * Math.PI, false, 0);
            const points = curve.getPoints(96).map(p => new THREE.Vector3(p.x, 0, p.y));
            const orbitLine = new THREE.Line(
                new THREE.BufferGeometry().setFromPoints(points),
                new THREE.LineBasicMaterial({ color: 0x00C2FF, transparent: true, opacity: 0.15 })
            );
            scene.add(orbitLine);

            // Planet
            const mesh = new THREE.Mesh(
                new THREE.SphereGeometry(d.size, 24, 24),
                new THREE.MeshPhongMaterial({ color: d.color, emissive: d.color, emissiveIntensity: 0.1, shininess: 30 })
            );

            // Ring
            if (d.ring) {
                const inner = d.ringThin ? 1.3 : 1.5;
                const outer = d.ringThin ? 1.6 : 2.3;
                const ring = new THREE.Mesh(
                    new THREE.RingGeometry(d.size * inner, d.size * outer, 48),
                    new THREE.MeshBasicMaterial({ color: d.ringThin ? 0x7DD3E8 : 0xE8D5B7, side: THREE.DoubleSide, transparent: true, opacity: d.ringThin ? 0.25 : 0.4 })
                );
                ring.rotation.x = d.ringThin ? Math.PI / 10 : Math.PI / 2.5;
                mesh.add(ring);
            }

            const angle = Math.random() * Math.PI * 2;
            mesh.position.x = Math.cos(angle) * d.r;
            mesh.position.z = Math.sin(angle) * d.r;
            scene.add(mesh);
            planets.push({ mesh, angle, ...d });
        });

        // Animation
        let timeScale = 1.0;
        let frameCount = 0;

        function animate() {
            requestAnimationFrame(animate);
            frameCount++;

            planets.forEach(p => {
                p.angle += p.speed * timeScale * 0.4;
                p.mesh.position.x = Math.cos(p.angle) * p.r;
                p.mesh.position.z = Math.sin(p.angle) * p.r;
                p.mesh.rotation.y += 0.008 * timeScale;
            });

            gridHelper.rotation.y += 0.0002 * timeScale;
            stars.rotation.y -= 0.00005 * timeScale;

            const pulse = 80 + Math.sin(performance.now() * 0.002) * 5;
            sunGlow.scale.set(pulse, pulse, 1);

            renderer.render(scene, camera);

            if (frameCount % 20 === 0) {
                const { x, y, z } = camera.position;
                document.getElementById('coords').innerText = `X:${Math.round(x)} Y:${Math.round(y)} Z:${Math.round(z)}`;
            }
        }
        animate();

        // Resize
        const ro = new ResizeObserver(() => {
            const w = container.clientWidth || window.innerWidth;
            const h = container.clientHeight || window.innerHeight;
            if (w > 0 && h > 0) {
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h, false);
            }
        });
        ro.observe(container);

        // Controls
        const slider = document.getElementById('speed-slider');
        slider.addEventListener('input', (e) => {
            timeScale = Math.max(0.2, parseFloat(e.target.value));
            document.getElementById('speed-val').innerText = timeScale.toFixed(1) + 'x';
        });

        function resetCam() {
            camera.position.set(0, 160, 220);
            camera.lookAt(0, 0, 0);
        }

        let gridVisible = true;
        function toggleGrid() {
            gridVisible = !gridVisible;
            gridHelper.visible = gridVisible;
        }

        // Time
        setInterval(() => {
            document.getElementById('system-time').innerText = new Date().toLocaleTimeString('en-US', { hour12: false });
        }, 1000);

        // ========== GUIDED TOUR ==========

        const tourSteps = [
            {
                target: 'header',
                title: 'Welcome to Nexus Control',
                body: 'Nexus is a private assistant that runs locally on your computer. Your files never leave your device.'
            },
            {
                target: 'capabilities',
                title: 'What Nexus Does For You',
                body: '"ON" means ready now. "CONNECT" is optional—you choose what to link. No surprises.'
            },
            {
                target: 'proof',
                title: 'Proof This Month',
                body: 'This shows the value: tasks completed, time saved, and data protected. Monthly evidence for your $49.99.'
            },
            {
                target: 'cta',
                title: 'Try It Now',
                body: 'Run a demo task to see Nexus work in ~10 seconds. Or book an install and we handle everything.'
            }
        ];

        let tourIdx = 0;
        const overlay = document.getElementById('tour-overlay');
        const spotlight = document.getElementById('tour-spotlight');
        const tooltip = document.getElementById('tour-tooltip');

        function showTour() {
            const seen = localStorage.getItem('nexus_tour_v5');
            if (seen) return;
            overlay.classList.remove('hidden');
            updateTourStep();
        }

        function updateTourStep() {
            const step = tourSteps[tourIdx];
            const target = document.querySelector(`[data-nexus-tour="${step.target}"]`);
            if (!target) return;

            const rect = target.getBoundingClientRect();
            spotlight.style.left = (rect.left - 8) + 'px';
            spotlight.style.top = (rect.top - 8) + 'px';
            spotlight.style.width = (rect.width + 16) + 'px';
            spotlight.style.height = (rect.height + 16) + 'px';

            // Position tooltip to the right of spotlight
            let tooltipX = rect.right + 20;
            let tooltipY = rect.top;

            // If not enough space on right, position below
            if (tooltipX + 320 > window.innerWidth) {
                tooltipX = Math.max(20, rect.left);
                tooltipY = rect.bottom + 20;
            }

            tooltip.style.left = tooltipX + 'px';
            tooltip.style.top = tooltipY + 'px';

            document.getElementById('tour-step-num').innerText = tourIdx + 1;
            document.getElementById('tour-title').innerText = step.title;
            document.getElementById('tour-body').innerText = step.body;

            document.getElementById('tour-prev').style.visibility = tourIdx === 0 ? 'hidden' : 'visible';
            document.getElementById('tour-next').innerHTML = tourIdx === tourSteps.length - 1
                ? 'Finish <i data-lucide="check" class="w-4 h-4"></i>'
                : 'Next <i data-lucide="chevron-right" class="w-4 h-4"></i>';

            lucide.createIcons();
        }

        function nextTourStep() {
            if (tourIdx >= tourSteps.length - 1) {
                closeTour();
                return;
            }
            tourIdx++;
            updateTourStep();
        }

        function prevTourStep() {
            if (tourIdx > 0) {
                tourIdx--;
                updateTourStep();
            }
        }

        function closeTour() {
            overlay.classList.add('hidden');
            localStorage.setItem('nexus_tour_v5', '1');
        }

        // Keyboard navigation for tour
        document.addEventListener('keydown', (e) => {
            if (overlay.classList.contains('hidden')) return;
            if (e.key === 'ArrowRight' || e.key === 'Enter') nextTourStep();
            if (e.key === 'ArrowLeft') prevTourStep();
            if (e.key === 'Escape') closeTour();
        });

        // Start tour after delay for first-time users
        setTimeout(showTour, 2000);
    </script>

</body>
</html>
