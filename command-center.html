<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS // ORBITAL_CORE</title>

    <!-- Font: JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        obsidian: '#020408',
                        panel: '#050a10',
                        cyan: '#00C2FF',
                        gold: '#FFD700',
                        amber: '#F59E0B',
                        red: '#EF4444',
                        border: 'rgba(0, 194, 255, 0.15)',
                        'border-dim': 'rgba(255, 255, 255, 0.05)',
                    },
                    fontSize: {
                        'xxs': '0.6rem',
                    },
                    letterSpacing: {
                        'widest': '0.15em',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            color-scheme: dark;
        }
        body {
            background-color: #020408;
            color: #e2e8f0;
            overflow: hidden;
            font-feature-settings: "zero" on;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Custom Thin Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #020408; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #00C2FF; }

        /* UTILITIES */
        .glass-panel {
            background: rgba(5, 10, 16, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 194, 255, 0.25);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5), 
                        inset 0 1px 0 rgba(0, 194, 255, 0.1);
        }
        
        .text-micro { font-size: 10px; line-height: 1.4; }
        .text-nano { font-size: 9px; letter-spacing: 0.1em; text-transform: uppercase; }

        /* SLIDER STYLING */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 14px;
            width: 6px;
            background: #00C2FF;
            transform: translateY(-6px);
            cursor: pointer;
            box-shadow: 0 0 12px rgba(0, 194, 255, 0.6);
            border-radius: 1px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            background: rgba(0, 194, 255, 0.2);
        }
        input[type=range]::-moz-range-thumb {
            height: 14px;
            width: 6px;
            background: #00C2FF;
            cursor: pointer;
            box-shadow: 0 0 12px rgba(0, 194, 255, 0.6);
            border: none;
            border-radius: 1px;
        }
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 2px;
            background: rgba(0, 194, 255, 0.2);
        }

        /* ANIMATIONS */
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .animate-pulse-slow { animation: pulse-slow 2.5s ease-in-out infinite; }

        /* Sidebar - responsive width */
        .sidebar {
            width: 280px;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .text-micro { font-size: 9px; }
            .text-nano { font-size: 8px; }
        }

        /* Collapsible sidebar for mobile */
        .sidebar-collapsed {
            width: 48px !important;
        }
        .sidebar-collapsed .sidebar-content {
            display: none;
        }
        .sidebar-collapsed .sidebar-toggle-icon {
            transform: rotate(180deg);
        }

        /* Button hover effects */
        .ctrl-btn {
            position: relative;
            overflow: hidden;
        }
        .ctrl-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 194, 255, 0.1), transparent);
            transition: left 0.3s ease;
        }
        .ctrl-btn:hover::before {
            left: 100%;
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col font-mono selection:bg-cyan/20 selection:text-cyan">

    <!-- HEADER: Compact -->
    <header class="h-10 md:h-12 border-b border-border bg-obsidian flex items-center justify-between px-3 md:px-4 z-40 relative shrink-0">
        <div class="flex items-center gap-3 md:gap-6">
            <div class="flex items-center gap-2">
                <i data-lucide="cpu" class="w-3.5 h-3.5 md:w-4 md:h-4 text-cyan"></i>
                <span class="text-[10px] md:text-xs font-bold tracking-widest text-cyan">NEXUS_CORE</span>
                <span class="text-[8px] md:text-[9px] text-gray-500 hidden sm:inline">v4.2</span>
            </div>
            
            <div class="h-4 w-px bg-white/10 hidden md:block"></div>
            
            <div class="hidden md:flex items-center gap-6">
                <div class="flex flex-col">
                    <span class="text-[9px] text-gray-500 uppercase tracking-wider">State</span>
                    <span class="text-[10px] text-emerald-400 tracking-wide font-medium flex items-center gap-1">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
                        OPTIMAL
                    </span>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] text-gray-500 uppercase tracking-wider">Uptime</span>
                    <span class="text-[10px] text-cyan tracking-wide font-medium">99.95%</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-4">
            <span class="text-[9px] md:text-[10px] text-gray-500 hidden sm:inline" id="system-time">--:--:--</span>
            <div class="flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1 bg-cyan/5 border border-cyan/20">
                <div class="w-1.5 h-1.5 rounded-full bg-cyan animate-pulse-slow"></div>
                <span class="text-[9px] md:text-[10px] text-cyan tracking-widest font-medium">LIVE</span>
            </div>
        </div>
        
        <div class="absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-cyan/40 to-transparent"></div>
    </header>

    <main class="flex-1 flex overflow-hidden bg-obsidian relative min-h-0">
        
        <!-- LEFT SIDEBAR: Collapsible on mobile -->
        <aside class="sidebar flex flex-col border-r border-border bg-[#030508] z-30 relative shrink-0" id="sidebar">
            
            <!-- Toggle Button (mobile) -->
            <button 
                class="md:hidden absolute -right-6 top-4 w-6 h-12 bg-panel border border-border border-l-0 rounded-r flex items-center justify-center z-50"
                onclick="toggleSidebar()"
            >
                <i data-lucide="chevron-left" class="w-4 h-4 text-cyan sidebar-toggle-icon transition-transform"></i>
            </button>

            <div class="sidebar-content flex flex-col h-full overflow-hidden">
                <!-- MODULE 1: SYSTEM RESOURCES -->
                <div class="p-3 md:p-4 border-b border-border-dim shrink-0">
                    <div class="flex justify-between items-center mb-2 md:mb-3">
                        <span class="text-nano text-cyan flex items-center gap-1.5">
                            <i data-lucide="activity" class="w-3 h-3"></i>
                            Resources
                        </span>
                        <span class="text-[8px] text-emerald-400 border border-emerald-400/30 px-1 py-0.5 bg-emerald-400/5">OK</span>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="group">
                            <div class="flex justify-between text-micro mb-1">
                                <span class="text-gray-400">CPU</span>
                                <span class="text-cyan font-medium" id="cpu-val">42%</span>
                            </div>
                            <div class="h-1 w-full bg-white/5 relative overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan to-cyan/70 transition-all duration-500" id="cpu-bar" style="width: 42%"></div>
                            </div>
                        </div>
                        
                        <div class="group">
                            <div class="flex justify-between text-micro mb-1">
                                <span class="text-gray-400">MEM</span>
                                <span class="text-cyan font-medium" id="mem-val">68%</span>
                            </div>
                            <div class="h-1 w-full bg-white/5 relative overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-cyan/90 to-cyan/60 transition-all duration-500" id="mem-bar" style="width: 68%"></div>
                            </div>
                        </div>

                        <div class="group">
                            <div class="flex justify-between text-micro mb-1">
                                <span class="text-gray-400">NET</span>
                                <span class="text-emerald-400 font-medium" id="net-val">1.2 GB/s</span>
                            </div>
                            <div class="h-1 w-full bg-white/5 relative overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-400/60 transition-all duration-500" id="net-bar" style="width: 35%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODULE 2: ORBITAL STATUS -->
                <div class="p-3 md:p-4 border-b border-border-dim shrink-0">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-nano text-gray-500 flex items-center gap-1.5">
                            <i data-lucide="orbit" class="w-3 h-3"></i>
                            Orbitals
                        </span>
                    </div>
                    
                    <div class="space-y-1.5" id="orbital-status">
                        <div class="flex items-center justify-between text-micro py-1 px-1.5 bg-white/[0.02]">
                            <span class="text-gray-400">SOL</span>
                            <span class="text-gold flex items-center gap-1 text-[9px]">
                                <span class="w-1.5 h-1.5 rounded-full bg-gold"></span>
                                ACTIVE
                            </span>
                        </div>
                        <div class="flex items-center justify-between text-micro py-1 px-1.5 bg-white/[0.02]">
                            <span class="text-gray-400">TERRA</span>
                            <span class="text-cyan flex items-center gap-1 text-[9px]">
                                <span class="w-1.5 h-1.5 rounded-full bg-cyan"></span>
                                TRACK
                            </span>
                        </div>
                        <div class="flex items-center justify-between text-micro py-1 px-1.5 bg-white/[0.02]">
                            <span class="text-gray-400">SATS</span>
                            <span class="text-emerald-400 flex items-center gap-1 text-[9px]">
                                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                6 ON
                            </span>
                        </div>
                    </div>
                </div>

                <!-- MODULE 3: EVENT LOG -->
                <div class="flex-1 overflow-hidden flex flex-col p-3 md:p-4 min-h-0">
                    <div class="flex justify-between items-center mb-2 shrink-0">
                        <span class="text-nano text-gray-500 flex items-center gap-1.5">
                            <i data-lucide="terminal" class="w-3 h-3"></i>
                            Log
                        </span>
                        <span class="text-[8px] text-cyan border border-cyan/20 px-1 py-0.5 bg-cyan/5">LIVE</span>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto space-y-1 pr-1 min-h-0" id="log-container">
                        <div class="text-micro flex gap-1.5 text-gray-400 py-0.5">
                            <span class="text-white/30 shrink-0 text-[9px]">--:--</span>
                            <span class="text-cyan/60 text-[9px]">Init...</span>
                        </div>
                    </div>
                </div>

                <!-- MODULE 4: CONTROLS -->
                <div class="p-3 md:p-4 bg-panel border-t border-border shrink-0">
                    <div class="mb-2 flex justify-between items-end">
                        <span class="text-nano text-gray-500">Speed</span>
                        <span class="text-micro text-cyan font-medium" id="speed-val">1.0x</span>
                    </div>
                    <input type="range" min="0.2" max="3" step="0.1" value="1" id="speed-slider" class="mb-3">
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button class="ctrl-btn border border-white/10 bg-white/5 hover:bg-cyan/10 hover:border-cyan/30 text-white/70 hover:text-cyan py-2 text-[9px] transition-all uppercase tracking-wider flex items-center justify-center gap-1" onclick="resetCam()">
                            <i data-lucide="crosshair" class="w-3 h-3"></i> Reset
                        </button>
                        <button class="ctrl-btn border border-white/10 bg-white/5 hover:bg-amber/10 hover:border-amber/30 text-white/70 hover:text-amber py-2 text-[9px] transition-all uppercase tracking-wider flex items-center justify-center gap-1" onclick="toggleGrid()">
                            <i data-lucide="grid-3x3" class="w-3 h-3"></i> Grid
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- RIGHT: ORBITAL ENGINE (Canvas) -->
        <section class="flex-1 relative bg-black min-w-0">
            
            <!-- CANVAS CONTAINER -->
            <div id="canvas-container" class="absolute inset-0 z-10"></div>

            <!-- HUD OVERLAY: Top Left - Target Lock -->
            <div class="absolute top-3 md:top-4 left-3 md:left-4 z-20 pointer-events-none">
                <div class="glass-panel px-3 py-2 md:px-4 md:py-3 min-w-[140px] md:min-w-[180px]">
                    <div class="flex flex-col gap-0.5 md:gap-1">
                        <div class="flex items-center gap-1.5 text-gold mb-0.5">
                            <i data-lucide="target" class="w-3 h-3"></i>
                            <span class="text-[8px] md:text-nano tracking-widest font-bold">TARGET</span>
                        </div>
                        <span class="text-[11px] md:text-sm font-medium text-white tracking-wide">SOLAR_BARYCENTER</span>
                        <div class="h-px w-full bg-white/10 my-1"></div>
                        <div class="flex justify-between text-[9px] md:text-micro text-gray-400">
                            <span>CLASS</span>
                            <span class="text-white/80">G-TYPE</span>
                        </div>
                        <div class="flex justify-between text-[9px] md:text-micro text-gray-400">
                            <span>MASS</span>
                            <span class="text-white/80">1.989×10³⁰</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HUD OVERLAY: Top Right - Metrics -->
            <div class="absolute top-3 md:top-4 right-3 md:right-4 z-20 pointer-events-none">
                <div class="glass-panel px-3 py-2 md:px-4 md:py-3 min-w-[100px] md:min-w-[120px]">
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center gap-1.5 text-cyan mb-0.5">
                            <i data-lucide="bar-chart-2" class="w-3 h-3"></i>
                            <span class="text-[8px] md:text-nano tracking-widest">PERF</span>
                        </div>
                        <div class="flex justify-between text-[9px] md:text-micro">
                            <span class="text-gray-500">FPS</span>
                            <span class="text-emerald-400 font-medium" id="fps-counter">60</span>
                        </div>
                        <div class="flex justify-between text-[9px] md:text-micro">
                            <span class="text-gray-500">OBJ</span>
                            <span class="text-cyan font-medium">14</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HUD OVERLAY: Bottom Right - Coordinates -->
            <div class="absolute bottom-3 md:bottom-4 right-3 md:right-4 z-20 pointer-events-none text-right">
                <div class="flex flex-col gap-0.5">
                    <span class="text-[8px] md:text-nano text-gray-500 tracking-widest">CAM</span>
                    <span class="text-[9px] md:text-[10px] text-cyan font-mono tracking-wider" id="coords">X:0 Y:250 Z:350</span>
                </div>
            </div>

            <!-- HUD: Corner Brackets -->
            <div class="absolute inset-3 md:inset-4 z-10 pointer-events-none">
                <div class="absolute top-0 left-0 w-6 h-6 md:w-8 md:h-8 border-t-2 border-l-2 border-cyan/30"></div>
                <div class="absolute top-0 right-0 w-6 h-6 md:w-8 md:h-8 border-t-2 border-r-2 border-cyan/30"></div>
                <div class="absolute bottom-0 left-0 w-6 h-6 md:w-8 md:h-8 border-b-2 border-l-2 border-cyan/30"></div>
                <div class="absolute bottom-0 right-0 w-6 h-6 md:w-8 md:h-8 border-b-2 border-r-2 border-cyan/30"></div>
            </div>

            <!-- Center crosshair -->
            <div class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none opacity-20">
                <div class="w-6 h-px bg-cyan"></div>
                <div class="absolute w-px h-6 bg-cyan"></div>
            </div>

        </section>
    </main>

    <script>
        // --- 1. INITIALIZATION ---
        lucide.createIcons();
        const container = document.getElementById('canvas-container');

        // Scene
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020408, 0.001);

        // FIX: Camera positioned higher and further back, looking at center
        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 2000);
        camera.position.set(0, 250, 350);
        camera.lookAt(0, 0, 0);

        // Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        container.appendChild(renderer.domElement);

        // --- 2. ORBITAL SYSTEM ---
        
        // Starfield
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2500;
        const starPos = new Float32Array(starCount * 3);
        for(let i = 0; i < starCount * 3; i++) {
            starPos[i] = (Math.random() - 0.5) * 1200;
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ 
            color: 0xaaaaaa, 
            size: 0.8, 
            transparent: true, 
            opacity: 0.8 
        });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // Grid
        const gridHelper = new THREE.PolarGridHelper(100, 12, 6, 48, 0x1e3a5f, 0x1e3a5f);
        gridHelper.material.transparent = true;
        gridHelper.material.opacity = 0.15;
        scene.add(gridHelper);

        // Sun (centered, larger glow)
        const sunGeo = new THREE.SphereGeometry(8, 32, 32);
        const sunMat = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
        const sun = new THREE.Mesh(sunGeo, sunMat);
        
        // Sun Glow
        const glowCanvas = document.createElement('canvas');
        glowCanvas.width = 256; glowCanvas.height = 256;
        const glowCtx = glowCanvas.getContext('2d');
        const glowGrad = glowCtx.createRadialGradient(128, 128, 0, 128, 128, 128);
        glowGrad.addColorStop(0, 'rgba(255, 220, 100, 1)');
        glowGrad.addColorStop(0.15, 'rgba(255, 180, 50, 0.8)');
        glowGrad.addColorStop(0.4, 'rgba(255, 120, 0, 0.3)');
        glowGrad.addColorStop(1, 'rgba(0, 0, 0, 0)');
        glowCtx.fillStyle = glowGrad;
        glowCtx.fillRect(0, 0, 256, 256);
        const glowTex = new THREE.CanvasTexture(glowCanvas);
        const sunGlowMat = new THREE.SpriteMaterial({ 
            map: glowTex, 
            transparent: true, 
            blending: THREE.AdditiveBlending 
        });
        const sunGlow = new THREE.Sprite(sunGlowMat);
        sunGlow.scale.set(60, 60, 1);
        sun.add(sunGlow);
        
        const sunLight = new THREE.PointLight(0xFFFFFF, 2, 500);
        sun.add(sunLight);
        scene.add(sun);

        const ambientLight = new THREE.AmbientLight(0x404060, 0.5);
        scene.add(ambientLight);

        // Planets (scaled down radii for better fit)
        const planets = [];
        const planetData = [
            { r: 18, size: 1.5, speed: 0.025, color: 0xA0A0A0, name: "MERC" },
            { r: 28, size: 2.2, speed: 0.018, color: 0xF59E0B, name: "VENUS" },
            { r: 40, size: 2.5, speed: 0.012, color: 0x00C2FF, name: "TERRA" },
            { r: 55, size: 2.0, speed: 0.009, color: 0xEF4444, name: "MARS" },
            { r: 75, size: 5.0, speed: 0.006, color: 0xE8D5B7, name: "JUP" },
            { r: 95, size: 4.2, speed: 0.004, color: 0xF4D03F, ring: true, name: "SAT" },
        ];

        planetData.forEach(d => {
            // Orbit line on XZ plane
            const orbitCurve = new THREE.EllipseCurve(0, 0, d.r, d.r, 0, 2 * Math.PI, false, 0);
            const orbitPoints = orbitCurve.getPoints(96).map(p => new THREE.Vector3(p.x, 0, p.y));
            const orbitGeo = new THREE.BufferGeometry().setFromPoints(orbitPoints);
            
            const orbitMat = new THREE.LineBasicMaterial({ 
                color: 0x00C2FF, 
                transparent: true, 
                opacity: 0.2 
            });
            const orbitLine = new THREE.Line(orbitGeo, orbitMat);
            scene.add(orbitLine);

            // Glow layer
            const orbitGlowMat = new THREE.LineBasicMaterial({
                color: 0x00C2FF,
                transparent: true,
                opacity: 0.06
            });
            const orbitGlow = new THREE.Line(orbitGeo.clone(), orbitGlowMat);
            orbitGlow.scale.set(1.01, 1.01, 1.01);
            scene.add(orbitGlow);

            // Planet
            const pGeo = new THREE.SphereGeometry(d.size, 24, 24);
            const pMat = new THREE.MeshPhongMaterial({ 
                color: d.color, 
                emissive: d.color,
                emissiveIntensity: 0.12,
                shininess: 30
            });
            const mesh = new THREE.Mesh(pGeo, pMat);
            
            // Ring for Saturn
            if (d.ring) {
                const rGeo = new THREE.RingGeometry(d.size * 1.5, d.size * 2.3, 48);
                const rMat = new THREE.MeshBasicMaterial({ 
                    color: 0xE8D5B7, 
                    side: THREE.DoubleSide, 
                    transparent: true, 
                    opacity: 0.4 
                });
                const ring = new THREE.Mesh(rGeo, rMat);
                ring.rotation.x = Math.PI / 2.5;
                mesh.add(ring);
            }

            // Random start position
            const angle = Math.random() * Math.PI * 2;
            mesh.position.x = Math.cos(angle) * d.r;
            mesh.position.z = Math.sin(angle) * d.r;

            scene.add(mesh);
            planets.push({ mesh, angle, ...d });
        });

        // --- 3. ANIMATION LOOP ---
        let timeScale = 1.0;
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 60;
        let fpsFrames = 0;

        function animate() {
            requestAnimationFrame(animate);
            frameCount++;
            fpsFrames++;
            
            // FPS
            const now = performance.now();
            if (now - lastTime >= 1000) {
                fps = fpsFrames;
                document.getElementById('fps-counter').innerText = fps;
                fpsFrames = 0;
                lastTime = now;
            }

            // Orbit planets
            planets.forEach(p => {
                p.angle += p.speed * timeScale * 0.4;
                p.mesh.position.x = Math.cos(p.angle) * p.r;
                p.mesh.position.z = Math.sin(p.angle) * p.r;
                p.mesh.rotation.y += 0.008 * timeScale;
            });

            // Rotate elements
            gridHelper.rotation.y += 0.0002 * timeScale;
            stars.rotation.y -= 0.00008 * timeScale;

            // Sun pulse
            const pulse = 60 + Math.sin(now * 0.002) * 4;
            sunGlow.scale.set(pulse, pulse, 1);

            renderer.render(scene, camera);

            // Update camera coords
            if (frameCount % 15 === 0) {
                const { x, y, z } = camera.position;
                document.getElementById('coords').innerText = 
                    `X:${Math.round(x)} Y:${Math.round(y)} Z:${Math.round(z)}`;
            }
        }
        animate();

        // --- 4. UI ---
        
        // Resize
        const ro = new ResizeObserver(() => {
            const w = container.clientWidth || window.innerWidth;
            const h = container.clientHeight || window.innerHeight;
            if (w > 0 && h > 0) {
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h, false);
            }
        });
        ro.observe(container);

        // Speed slider
        const slider = document.getElementById('speed-slider');
        const speedVal = document.getElementById('speed-val');
        slider.addEventListener('input', (e) => {
            timeScale = Math.max(0.2, parseFloat(e.target.value));
            speedVal.innerText = timeScale.toFixed(1) + 'x';
            speedVal.style.color = timeScale > 2 ? '#EF4444' : '#00C2FF';
        });

        function resetCam() {
            camera.position.set(0, 250, 350);
            camera.lookAt(0, 0, 0);
        }

        let gridVisible = true;
        function toggleGrid() {
            gridVisible = !gridVisible;
            gridHelper.visible = gridVisible;
        }

        // Sidebar toggle (mobile)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('sidebar-collapsed');
        }

        // System time
        function updateTime() {
            const t = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('system-time').innerText = t;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Resource bars
        function updateResources() {
            const cpu = 35 + Math.random() * 20;
            const mem = 60 + Math.random() * 15;
            const net = 30 + Math.random() * 25;
            
            document.getElementById('cpu-val').innerText = Math.round(cpu) + '%';
            document.getElementById('cpu-bar').style.width = cpu + '%';
            document.getElementById('mem-val').innerText = Math.round(mem) + '%';
            document.getElementById('mem-bar').style.width = mem + '%';
            document.getElementById('net-val').innerText = (net / 20).toFixed(1) + ' GB/s';
            document.getElementById('net-bar').style.width = net + '%';
        }
        setInterval(updateResources, 3000);

        // Event log
        const logMsgs = [
            { t: 'info', m: 'Orbital_Sync' },
            { t: 'info', m: 'Telemetry_OK' },
            { t: 'ok', m: 'Packet_Verified' },
            { t: 'info', m: 'Thermal_Nominal' },
            { t: 'info', m: 'Sector_Scanned' },
            { t: 'warn', m: 'Flux_Elevated' },
            { t: 'ok', m: 'Nav_Lock' },
            { t: 'info', m: 'Buffer_Flush' },
        ];
        const logEl = document.getElementById('log-container');
        
        function addLog() {
            const e = logMsgs[Math.floor(Math.random() * logMsgs.length)];
            const div = document.createElement('div');
            div.className = 'text-[9px] flex gap-1.5 py-0.5';
            const time = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
            let color = 'text-cyan/70';
            if (e.t === 'ok') color = 'text-emerald-400/80';
            if (e.t === 'warn') color = 'text-amber/80';
            div.innerHTML = `<span class="text-white/30 shrink-0">${time}</span><span class="${color}">${e.m}</span>`;
            logEl.prepend(div);
            while (logEl.children.length > 20) logEl.removeChild(logEl.lastChild);
        }
        setInterval(addLog, 2500);
        addLog();
    </script>

</body>
</html>
